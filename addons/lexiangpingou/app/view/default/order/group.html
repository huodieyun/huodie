{php include wl_template('common/header');}
<style> 
		.link-rule{
		height:100%;
		width:100%;
		background-color:
		rgba(128,128,128,0.5);
		position:fixed;top:0px;
		left:0px;
		z-index:10000;
	}
	.fixRT{
		display: none;
	}
	.link-rule>div>div div:last-child{
		 position:absolute;
		 left:0px;
		 right:0px;
		 width:150px;
		 height:30px;
		 bottom:5px;
		 background-color:#0894ec;
		 color:white;
		 font-size:18px;
		 margin-left:auto;
		 margin-right:auto;
		 line-height:30px;
		 border-radius:5px;
	}
	
	.link-rule>div{
		text-align:center;
		position:absolute;
		top:0;
		bottom:0;
		left:8px;
		right:8px;
		margin-top:auto;
		margin-bottom:auto;
		height:85%;
		background-color:white;
		border-radius:8px;
	}
	.link-rule>div>div:first-child{
		 font-weight:bold;
		 background-color:#ececec;
		 font-size:20px;
		 line-height:40px;
		 border-radius:8px 8px 0 0;
		 height:40px;
	}
	.link-rule>div div:nth-child(2){
		 text-align:left;
		 position:absolute;
		 top:48px;
		 bottom:45px;
		 left:19px;
		 right:19px;
		 overflow:scroll;
	}
	.progressStep:first-child{ border:1px solid transparent!important;background-color:transparent!important;}
	.goods-rule{
		height:100%;
		width:100%;
		background-color:
		rgba(128,128,128,0.5);
		position:fixed;top:0px;
		left:0px;
		z-index:10000;
	}
	
	.goods-rule>div div:last-child{
		 position:absolute;
		 left:0px;
		 right:0px;
		 width:150px;
		 height:30px;
		 bottom:5px;
		 background-color:#0894ec;
		 color:white;
		 font-size:18px;
		 margin-left:auto;
		 margin-right:auto;
		 line-height:30px;
		 border-radius:5px;
	}
	
	.goods-rule>div{
		text-align:center;
		position:absolute;
		top:0;
		bottom:0;
		left:8px;
		right:8px;
		margin-top:auto;
		margin-bottom:auto;
		height:85%;
		background-color:white;
		border-radius:8px;
	}
	.goods-rule>div>div:first-child{
		 padding:19px;
		 padding-top:10px;
		 padding-bottom:10px;
		 
		 font-weight:bold;
		 background-color:#ececec;
		 font-size:20px;
		 line-height:28px;
		 border-radius:8px 8px 0 0;
		 display:block;
		 
	}
	.goods-rule>div div:nth-child(2){
		 padding-left:24px; padding-right:24px;
		 font-size:14px;
		 line-height:16px;
		 margin:0 auto;
		 height: 70%;
		 clear:both;
		 overflow: auto;
	}
	.goods-rule>div div:last-child{
		 
		 width:150px;
		 height:30px;
		 margin-bottom:23px;
		 background-color:#0894ec;
		 color:white;
		 font-size:18px;
		 margin-left:auto;
		 margin-right:auto;
		 line-height:30px;
		 border-radius:5px;
	}
		.pinTuanJia{
			padding:10px;
		}
		.pinTuanJia>div.ptjTxt{
			float: left;
			background: #6fbfd8;
			font-size: 18px;
			color: #fff;
			width: 60px;
			height: 30px;
			line-height: 30px;
			border-top-left-radius: 5px;
			border-bottom-left-radius: 5px;
			text-align: center;
		}
		.pinTuanJia>div:last-child{
			display:inline-block;
		}
		.pinTuanJia ul{
			border: 1px solid #ddd;
			border-bottom:none;
		}
		.pinTuanJia li{
			height: 30px;
			line-height: 30px;
			padding: 0 10px;
			border-bottom: 1px solid #ddd;
		}

		.pinTuanJia li.active,.salesVolume b.active{
			color:#6fbfd8;
		}
		.pinTuanJia li text{
			/*margin-right:10px;*/
			min-width: 80px;
			display: inline-block;
		}
		.pinTuanJia li img,.salesVolume b img{
			position: relative;
			right: -8px;
			width:70px;
			margin-right: 10px;
		}
		button{
			background-color: {$_W['system_color']};
		}
		.aboutProduct{
			margin-left: -10px;
			width: 106%;
		}
	@media screen and (min-width: 370px){
		.aboutProduct{
			width: 104%;
		}
	}
		#guide img{
			width: inherit;
			height: inherit;
		}

		.tuan_num p{
			padding: 2px 0 10px 0;
			display: flex;
			display: -webkit-flex;
			align-items: center;
			-webkit-align-items: center;
		}
		.tuan_num img{
			width: 13px;
			margin-right: 5px;
		}
		.tuan_num input{
			width: 63px;
			height: 25px;
			text-align: center;
			border-radius: inherit;
			-webkit-border-radius: inherit;
			border:1px solid #aaa;
		}
		.tuan_num a{
			display: inline-block;
			width: 35px;
			height: 25px;
			text-align: center;
			color: #fff;
			background: #aaa;
		}
		.tuan_num .minus{
			border-top-left-radius: 5px;
			border-bottom-left-radius: 5px;
		}
		.tuan_num .add{
			border-top-right-radius: 5px;
			border-bottom-right-radius: 5px;
		}
</style>

<span id="numPerson">{$numPerson}</span>
<span id="numPrices">{$numPrices}</span>
<span id="numGroup">{$numGroup}</span>
<span id="goodsid">{$goods['id']}</span>
<div class="page-group">
	<div></div>
    <div class="page page-current" id="page-order-list">
    <div class="content" style="padding-bottom: 60px;">
		{if $tuaninfo['groupstatus']==3}
        <div class="H5_con" id="H5_con1">
	    <div class="tips topStateWrap tips_succ tips_succ2" id="originTopWrap">
			<div class="tips_ico"></div>
			<div class="tips_tit">组团进行中</div>
			<div class="tips_txt">赶快召唤小伙伴加入吧！</div>
		</div>
   		</div>
   		{elseif $tuaninfo['groupstatus']==2}
   		<div class="H5_con" id="H5_con1">
        <div class="tips topStateWrap tips_succ tips_succ2" id="originTopWrap">
            <div class="tips_ico"></div>
            <div class="tips_tit">团购成功</div>
            <div class="tips_txt">我们会尽快为您发货，请耐心等待</div>
        </div>
        </div>
        {else}
        <div class="H5_con" id="H5_con1">
        <div class="tips topStateWrap tips_err tips_succ2" id="originTopWrap">
            <div class="tips_ico"></div>
            <div class="tips_tit">团购失败</div>
            <div class="tips_txt">组团失败，不要气馁重新再来！</div>
        </div>
        </div>
        {/if}
        <div class="H5_con">
            <div class="tm {if $tuaninfo['groupstatus']==2}tm_succ{elseif $tuaninfo['groupstatus']==1}tm_err{/if}">
                <div class="td tuanDetailWrap">
                    <div class="td_img">
                        <a {if $goods['one_group']==0}href="{php echo app_url('goods/detail', array('id' => $goods['id'],'tuan_id'=>$tuan_id))}"{else}href="javascript:;"{/if} class="external goItemPage"><img src="{$goods['share_image']}" alt=""></a>
                    </div>
                    <div class="td_info">
                        <p class="td_name">{$tuaninfo['goodsname']}</p>
                        <p class="td_mprice"><span class="tuanTotal">{$tuaninfo['neednum']}</span>人团：<i>￥</i><b>{$goods['gprice']}</b><i> /{$goods['unit']}</i></p>
                        <p class="td_attr" style="display: none;">属性：<span></span></p>
						<p class="td_attr" style="display: block;">团单号：{$order['tuan_id']}<span></span></p>
                        <p><span id="goodsdetail" style="display:none;color:red; font-size:16px;">查看详情&gt;</span></p>
                        <p class="td_num"></p>
                    </div>
                </div>
				<div class="editor"></div>
            </div>
        </div>

					{if $goods['isshowsend']==1}
			 <div class="step" style="margin-top:-10px;" data-unuse="1" style=" text-align:center;">
                <div class="step_hd">
                    <b>成团记录：</b>只显示最新成功组团成功的几个团

                </div>

                      <MARQUEE loop=-1 scrollAmount=1 scrollDelay=1 direction=up width=100% height=63
					&#111;nmouseout="this.start()" &#111;nmouseover="this.stop()">
					  {loop $sendadd $adv}
					{$adv['content']}
					{/loop}
					 </MARQUEE>

                            </div>
							{/if}
							{if $tuaninfo['selltype']==4}
				<div style="background-color: white;padding: 20px 0px;">
							<?php
				$nownum=count($orders);
									 $pernow=$count['num']/$numGroup*100;
									 ?>
					<div class="pinTuanJia" data-num="{$count['num']}" data-total_num="{$total_num}">
						{if $goods['is_amount']=='1'}
						<div class="tuan_num">
							<p><image src="../../../../../../addons/lexiangpingou/app/resource/images/group/num.png"></image>购买数量
								<a class="minus" href="javascript:;">-</a><input type="number" value="1"/><a class="add" href="javascript:;">+</a>
							</p>
						</div>
						{/if}
						<div class="ptjTxt">拼团价</div>

						<div>
							<ul>
								{loop $param_level $item}
								<li  data-id="{$item['groupnum']}"><text>￥{$item['groupprice']}</text>
									{$item['groupnum']}
									{if $goods['is_amount']=='1'}件
									{else}人
									{/if}
								</li>
								{/loop}

							</ul>
						</div>
					</div>
				<div class="process" style="margin-top:20px;margin-bottom:20px;position:relative;width:89%;margin-left:4%;height:20px;border-radius:10px;background-color:white;border:1px solid hsl(354, 91%, 73%)">
					<div class="progress" style="background-image:linear-gradient(90deg,#6fbfd8,hsl(354, 91%, 73%));height:100%;border-radius:10px;left:0px;top:0px;width:{$pernow}%">
						{loop $param_level $item}
						<?php
							$per=$item['groupnum']/$numGroup*100;
						?>
						<div class="progressStep" style="display:none;border:1px solid white;height:14px;width:4px;border-radius:7px;position:absolute;top:2px;background-color:white;left:{$per}%;">
							<div class="progressNum" style="position: absolute;top: -20px;width: 40px;text-align: center;left: -20px;line-height: 20px;height: 20px;">{$item['groupnum']}</div>
							<div class="progressPrice" style="position: absolute;top: 14px;width: 40px;text-align: center;left: -20px;line-height: 20px;height: 20px;">{$item['groupprice']}</div>
						</div>
						{/loop}

						<div class="recentprogress" style="background-color:transparent;border:1px solid white;height:14px;width:100%;border-radius:7px;position:absolute;top:-15px;background-color:white;left:$pernow}%;">
							<div class="recentNum" style="color:red;position: absolute;top: -8px;width: 100%;text-align: right;line-height: 20px;height: 20px;">{$nownum}</div>
							<div class="recentPrice" style="display:none;color:red;position: absolute;top: 14px;width: 105px;text-align: right;left: -100px;line-height: 20px;height: 20px;">0.1</div>

						</div>
						<!--<div class="unitUp" style="position:absolute;right:-30px;top:-18px;">/人</div>-->
						<!--<div class="unitUp" style="position:absolute;right:-30px;top:16px;">/元</div>-->
					</div>
				</div>
				<script>
							var numPerson = document.getElementById("numPerson").textContent.slice(1).split(",");
							var numPrice  = document.getElementById("numPrices").textContent.slice(1).split(",");
							var progress = document.getElementsByClassName("progress");
							var recentNums = document.getElementsByClassName("recentNum");
							var recentPrices = document.getElementsByClassName("recentPrice");
							var Len = recentNums.length;
							var recentNum = Number(recentNums[Len - 1].textContent);
							var recentPrice = recentPrices[Len - 1];
							var priceLen = numPrice.length;
							var recentprogress = document.getElementsByClassName("recentprogress");
							for (var i = 0; i < priceLen; i++){
								if (recentNum < Number(numPerson[priceLen - 1])) {
									recentPrice.textContent = numPrice[priceLen - 1]+"元";
									break;
								}
								else if (recentNum == Number(numPerson[0])) {
									recentPrice.textContent = numPrice[0]+"元";
									break;
								}
								else if (recentNum >= Number(numPerson[i+1]) && recentNum < Number(numPerson[i])) {
									recentPrice.textContent = numPrice[i+1]+"元";
									break;
								}
							}
							var percent = 0;
							recentprogress[Len -1].style.left = percent;


							//团列表
							if("{$goods['is_amount']}"=='1'){
								var nownum=parseInt($('.pinTuanJia').attr('data-num'));
								$('.recentNum').html("已参团"+nownum+"件")
							}else{
								var nownum=parseInt($('.pinTuanJia').attr('data-num'));
								$('.recentNum').html("已参团"+nownum+"人")
							}
							var lis=$('.pinTuanJia li');
							var len=lis.length-1;
							if($('.pinTuanJia li').length<=1){
								$('.pinTuanJia').css('display','none');
							}else {
								for (var i = 0; i < lis.length; i++) {
									//console.log(parseInt($(lis[len]).attr('data-id')));
									//console.log($(lis[i]).attr('data-id'));
									if (nownum < parseInt($(lis[i]).attr('data-id'))) {
										$(lis[i]).addClass('active').append('<image src="../../../../../../addons/lexiangpingou/app/resource/images/group/hand2.png"/>');
										i = lis.length + 1;
									} else if (nownum == parseInt($(lis[i]).attr('data-id'))) {
										$(lis[i]).addClass('active').append('<image src="../../../../../../addons/lexiangpingou/app/resource/images/group/hand2.png"/>');
										i = lis.length + 1;
									} else if (nownum >= parseInt($(lis[i]).attr('data-id'))) {
										i++;
										if (nownum < parseInt($(lis[i]).attr('data-id'))) {
											$(lis[i - 1]).addClass('active').append('<image src="../../../../../../addons/lexiangpingou/app/resource/images/group/hand2.png"/>');
											i = lis.length + 1;
										}
										i--;
									}
									if (nownum >= parseInt($(lis[len]).attr('data-id'))) {
										i = lis.length - 1;
										$(lis[i]).addClass('active').append('<image src="../../../../../../addons/lexiangpingou/app/resource/images/group/hand2.png"/>');
									}
								}
							}
						</script>
						</div>
						{/if}
        <div class="pp" style="margin-top:-5px;">
		{if $tuaninfo['selltype']!=4}
            <div class="pp_users">
            	{loop $orders $or}
            	<a href="#" class="pp_users_item pp_users_normal"><img src="{$or['avatar']}"></a>
            	{/loop}
				{loop $num_arrs $item}
                <a href="#" class="pp_users_item pp_users_normal"><img src="{TG_URL_ARES}images/avatar.png"></a>
                {/loop}
				{if $tuaninfo['neednum']>300}
				<a href="#" class="pp_users_item pp_users_normal"><img  src="../addons/feng_fightgroups/template/img/dian.png" ></a>
				
				{/if}
				{if $tuaninfo['groupstatus']!=2}
            	{loop $num_arr $item}
                <a href="#" class="pp_users_item pp_users_normal"><img src="{TG_URL_ARES}images/avatar.png"></a>
                {/loop}
				{loop $lastorders $or}
            	<a href="#" class="pp_users_item pp_users_normal"><img src="{$or['avatar']}"></a>
            	{/loop}
            	
            	<div class="pp_tips" id="flag_0_a">{if $tuaninfo['groupstatus']==3}<div class="pp_tips">已有<b >{php echo ($tuaninfo['neednum']-$tuaninfo['lacknum'])}</b>人参团,还差<b>{$tuaninfo['lacknum']}</b>人</div>{/if}</div>
            	{/if}
            </div>
			{/if}
			{if $tuaninfo['selltype']==4&&$tuaninfo['groupstatus']==3}
			<div class="pp_tips" id="flag_0_a">还差
				<b>{$tuaninfo['lacknum']}</b>
				{if $goods['is_amount']=='1'}
				件
				{else}
				人
				{/if}
				,就可以团购到最低价</div>
			{/if}
            {if $tuaninfo['groupstatus']==2}<div class="pp_tips">对于诸位大侠的相助，团长感激涕零</div>{/if}

            <div class="pp_state">
            	{if $tuaninfo['groupstatus']==3}
                <div class="pp_time"></div>
                {elseif $tuaninfo['groupstatus']==2}
                <div class="pp_state_txt">团购成功，我们将尽快发货</div>
                {else}
                <div class="pp_state_txt">团购失败，召唤小伙伴失败</div>
                {/if}
            </div>
            <div class="pp_list" >
                <div id="showYaoheList" >
                	{php $onum=1;}
                	{loop $orders $or}
                    <div class="pp_list_item" style="background-color:#f97b87;border-color:#f97b87;">
                        <img src="{$or['avatar']}" class="pp_list_avatar">
						<div class="pp_list_info">
						<span class="pp_list_name">
						{if $onum==1}团长{/if}<b>{$or['nickname']}</b>{if $onum==1}发话{else}驾哈雷赶到{/if}
						</span>
						<span class="pp_list_time">{php echo date('m-d H:i', $or['starttime'])}{if $onum==1}开团{else}参团{/if}</span>
						</div>
						<div class="pp_list_words">{if $onum==1}好货不容留，快来跟我一起抢。{else}立马参团，有钱就是任性。{/if}</div>
                    </div>
                    {if $onum==2}
                    {php break;}
                    {/if}
                    {php $onum++;}
                    {/loop}
            	</div>
        	</div>
        	<div class="pp_state">
                <div class="pp_state_txt" onclick="$('.m-detail-record').toggle();" style="background-color: white;">查看更多</div>
            </div>
        <div class="m-detail-record" style="display: none;">
            <div class="w-bar">参团记录 <span class="w-bar-hint">(自{php echo date('m-d H:i', $tuaninfo['starttime'])}开团)</span></div>
                <div class="m-detail-record-wrap">
	                <div id="pro-view-4">
	                <ul class="m-detail-record-list" data-pro="entry" id="morelist">
	                	{loop $orders $or}
	                	<li id="pro-view-5">
	                		<div class="f-clear">
	                			<div class="avatar"><a href="#"><img width="35" height="35" src="{$or['avatar']}"></a></div>
	                			<div class="text"><p class="f-breakword"><a href="#">{if $or['nickname']==""}...{else}{$or['nickname']}{/if}</a>{if !empty($lists['ip'])}<span class="address">( IP:{$lists['ip']}  {$lists['ipaddress']})</span>{/if}</p><p><span class="num">参团时间：     {php echo date('Y-m-d H:i:s',$or['createtime'])} {if $or['ordertype']==1}<font color="#4CA052">代付</font>{/if}</p></div>
	                		</div>
	                	</li>
	                	{/loop}
	                </ul>
	               	</div>
                </div>
            </div>
   		</div>

        <section class="stepGuild" style="margin-top:-5px;">
        	{if $setting['group_rule_switch'] != 2}
	        <div class="step_tit"><i></i>{if $tuaninfo['selltype']==4}阶梯团玩法{elseif $tuaninfo['selltype']==6}新专团玩法{elseif $goods['selltype']==3}自选团玩法{else}拼团玩法{/if}<span><span id="lookdetail">查看详情&gt;</span></span></div>
	        <div class="step_flow">
	            <div class="step_item"><span class="step_num">1</span><span>选择<br>心仪商品</span></div>
	            <div class="step_item"><span class="step_num">2</span><span class="steps">支付开团<br>或参团</span></div>
	            <div class="step_item {if $tuaninfo['groupstatus']==3 || $tuaninfo['groupstatus']==1 }step_item_on{/if}"><span class="step_num">3</span><span class="steps">邀请好友<br>参团支付</span></div>
	            <div class="step_item {if $tuaninfo['groupstatus']==2}step_item_on{/if}"><span class="step_num">4</span><span class="steps">达到人数<br>{if $tuaninfo['selltype']==4}拿最低价{else}团购成功{/if}</span></div>
	        </div>
	        {/if}
			<div class="section_body info_detail" style="border:none;{if $goods['isjudgment']==0}display:none;{/if}">
				<div class="orderregion" style="border-bottom: none; margin-bottom: 10px;">
					<h1 class="orderregion-title">
						<i class="icon1-detail status-detail-icon"></i>
						<label class="status-name">买家评价</label>
						<a href="{php echo app_url('goods/judgment_list',array('op' => 'judgment_list','gid' => $goods['id']))}"><span style="float: right; color: #9d9d9d; font-size: 14px; height: 40px;line-height: 40px;  display: inline-block; ">共{$total}条记录&gt;</span></a>
					</h1>

					{loop $list $item}

					<div style="clear: both; padding:10px; padding-bottom:0px; text-align: justify; border-bottom: 1px solid #f0f0f0;">
						<div style="width: 12%; float: left;">
							<img style="height: 35px; width: 35px;border-radius: 50%" src="{$item['avatar']}" >
						</div>
						<div style="width: 80%; float:left;margin-left: 10px; ">
							<span style="color: #666;">{$item['openname']}</span><br>
							<span style="color: #666; font-size: 12px; ">{$item['time']}</span>
						</div>
						<div style="clear: both;"></div>
						<?php
							$main_content = pdo_fetch("select * from ".tablename('tg_judgment_content')." where  judgment_id=:judgment_id order by update_time asc ",array('judgment_id'=>$item['judgment_id']));
						$allcontent = pdo_fetchall("select * from ".tablename('tg_judgment_content')." where  judgment_id=:judgment_id and content_id <> '". $main_content['content_id'] ."'  order by update_time asc ",array('judgment_id'=>$item['judgment_id']));
						?>
						<div style="font-size: 0.9em; padding-top: 3px; padding-bottom: 3px; color: #1a1a1a;">{$main_content['content']}</div>
						{loop $allcontent $content}
						{if $content['who']== 1}<label class="zhuiping">商家回复</label>{/if}
						{if $content['who']== 0}<label class="zhuiping">用户追评</label>{/if}<span style="margin-left:10px; color: #b8c0cc; font-size: 12px;"><?php echo date('Y-m-d H:i:s',$content['update_time']); ?></span>
						<div style="font-size: 12px; font-weight: 400;padding-bottom: 3px;">{$content['content']}</div>

						{/loop}

					</div>
					{/loop}

				</div>
			</div>

			<div class="section_body info_detail">
				<div>
					<div id="div_nav_fixed">
						<div id="div_nav" class="div_nav">
							<ul class="boxx" style="padding-left: 0px;">
								<li>
									<a onclick="exchange(1);" data-idx="1" class="sp on" id="shangpin1">图文详情</a>
								</li>
								<li>
									<a onclick="exchange(0);" data-idx="0" class="sp" id="shangpin0">商品属性</a>
								</li>
							</ul>
						</div>
					</div>
					<div id="div_sections" class="div_sections">
						<section class="section_specification">
							{loop $params $p}
							<dl>
								<div>
									<dd><label>{$p['title']}</label><label>{$p['value']}</label></dd>
								</div>
							</dl>
							{/loop}
						</section>
						<section class="section_detail on" data-role="widget" data-widget="img_prev_view">
							<div id="description" class="J_DetailSection tshop-psm tshop-psm-bdetaildes" style="margin:0px;padding:0px;">
								<div class="ke-post" id="productInfott" style="margin:10px 0px 0px;padding:0px;font-size:14px;font-family:tahoma, arial, 宋体, sans-serif;">

								</div>
							</div>
						</section>
					</div>
				</div>
			</div>

			<!--猜你喜欢-->
<h2 class="guesslike">猜你喜欢 ❤</h2>
<ul class="aboutProduct"></ul><!--aboutProduct-->
<script type="text/javascript">guesslike("{php echo app_url('goods/ajaxlist/goods_rand')}");</script>

	    </section>
    </div>
	<?php
	$check_includ=0;
	if($goods['hasoption']==1&&$goods['selltype']!=3&&$check_includ==0)
	{
		$check_includ=1;
	}
	if($goods['one_limit']>=1&&$goods['selltype']!=3&&$check_includ==0)
	{
		$check_includ=1;
	}
	if($goods['many_limit']>=1&&$goods['selltype']!=3&&$check_includ==0)
	{
		$check_includ=1;
	}
		if($check_includ==1)
		{

		  include wl_template('goods/goods_option');
		}
	?>

		{if $goods['selltype']==3}
		{php include wl_template('goods/goods_ladder');}
		{/if}
    <div class="H5_con fixopt" id="fixopt" style="display: block;">
        <div class="address_new">
            {if !empty($myorder)}
                {if $tuaninfo['groupstatus']==3}
                <span style="display:block;float:left;width: 80%;margin-left: 5px;">
                <button class="bottombutton" style="fllow:left;width: 100%;color:#fff" onclick="_system._guide(true);hecheng()">还差{$tuaninfo['lacknum']}
					{if $goods['is_amount']=='1'}
					件
					{else}
					人
					{/if}
					{if $tuaninfo['selltype']==4}拿到最低价{else}组团成功{/if},立即召唤小伙伴</button>
                </span>
                 <span style="display:block;float:right;width: 15%;">
	             <button style="width: 90%;color:#fff"><a href="{php echo app_url('home/index')}" class="nav-controller external">首页
	            </a></button>
	            </span>
                {else}

                <span style="display:block;float:left;width: 80%;margin-left: 5px;">
					{if $check_includ==0 }
						{if $tuaninfo['one_group_number'] != null}
						   <a href="{php echo app_url('order/group',array('tuan_id'=>$tuaninfo['one_group_number']));}" class="external">
						       <button style="fllow:left;width: 100%;color:#fff">团购已{if $tuaninfo['groupstatus']==1}失败{/if}{if $tuaninfo['groupstatus']==2}成功{/if},点击继续参团</button>
						   </a>
						{else}
							{if $goods['selltype']==3}
							<a href="{php echo app_url('goods/detail',array('id'=>$goods['id']));}" class="external">

							{else}
							 <a href="javascript:;" onclick="goNewtuan()" class="external">
							{/if}
							<button style="fllow:left;width: 100%;color:#fff">团购已{if $tuaninfo['groupstatus']==1}失败{/if}{if $tuaninfo['groupstatus']==2}成功{/if},点击新开一团</button>
							</a>
						{/if}
					{else}
					<a onclick='choose(2)'>
					<button style="fllow:left;width: 100%;color:#fff">团购已{if $tuaninfo['groupstatus']==1}失败{/if}{if $tuaninfo['groupstatus']==2}成功{/if},点击新开一团</button>
					</a>
					{/if}
					</span>

				   <span style="display:block;float:right;width: 15%;">
					 <button style="width: 90%;color:#fff"><a href="{php echo app_url('home/index')}" class="nav-controller external">首页
					</a></button>
				   </span>
                {/if}
            {else}
	            {if $tuaninfo['groupstatus']==3}
	            <span style="display:block;float:left;width: 80%;margin-left: 5px;">
	            	{if $goods['hasoption']==1||$goods['one_limit']>=1||$goods['many_limit']>=1}
	           			 <a onclick='choose(2)'><button class="bottombutton" style="fllow:left;width: 100%;color:#fff">我要参团</button>
	            </a>
	           		{else}
		           		{if $result['statustype'] == 1 && $tuaninfo['selltype']==6}
			           		<a class="close" onclick='$(".open").show();$(".close").hide()' class="external">
			           			<button class="bottombutton" style="fllow:left;width: 100%;color:#fff">我要参团 </button>
			           		</a>
			           		<a class="open" href="{php echo app_url('order/orderconfirm',array('groupnum'=>$goods['groupnum'],'id'=>$goods['id'],'newtuan'=>'newtuan'));}" style="display: none;" >
			           			<button class="bottombutton" style="fllow:left;width: 100%;color:#fff">我要当团长 </button>
			           		</a>
			           	{else}
		           			 <a href="javascript:;" class="external cantuan_num"><button class="bottombutton" style="fllow:left;width: 100%;color:#fff">我要参团</button>
	            </a>
		           		{/if}
	           		{/if}

	            </span>
	            <span style="display:block;float:right;width: 15%;">
	             <button style="width: 90%;color:#fff"><a href="{php echo app_url('home/index')}" class="nav-controller external">首页
	            </a></button>
	            </span>
	            {else}

	            <span style="display:block;float:left;width: 80%;margin-left: 5px;">
	            {if $goods['hasoption']!=1}
	            	{if $tuaninfo['one_group_number'] != null}
	            	   <a href="{php echo app_url('order/group',array('tuan_id'=>$tuaninfo['one_group_number']));}" class="external">
	            	       <button style="fllow:left;width: 100%;color:#fff">团购已{if $tuaninfo['groupstatus']==1}失败{/if}{if $tuaninfo['groupstatus']==2}成功{/if},点击继续参团</button>
	            	   </a>
	            	{else}
	             	{if $goods['one_limit']>1||$goods['selltype']==3}
	           			 <a onclick='choose(2)'>
	           		{else}
	           			 <a href="{php echo app_url('order/orderconfirm',array('id' => $goods['id'],'tuan_id' => $tuan_id,'groupnum'=>$tuaninfo['neednum']));} " class="external">
	           		{/if}
	            <button class="bottombutton" style="fllow:left;width: 100%;color:#fff">团购已{if $tuaninfo['groupstatus']==1}失败{/if}{if $tuaninfo['groupstatus']==2}成功{/if},点击新开一团</button>
	           	</a>
							 {/if}
	           	{else}
	           	{if $goods['hasoption']==1||$goods['one_limit']>1||$goods['selltype']==3}
	           			 <a onclick='choose(2)'>
	           		{else}
	           			 <a href="{php echo app_url('order/orderconfirm',array('id' => $goods['id'],'tuan_id' => $tuan_id,'groupnum'=>$tuaninfo['neednum']));} " class="external">
	           		{/if}
	            <button class="bottombutton" style="fllow:left;width: 100%;color:#fff">团购已{if $tuaninfo['groupstatus']==1}失败{/if}{if $tuaninfo['groupstatus']==2}成功{/if},点击新开一团</button>
	           	</a>
	           	{/if}
	            </span>
	            <span style="display:block;float:right;width: 15%;">
	             <button style="width: 90%;color:#fff"><a href="{php echo app_url('home/index')}" class="nav-controller external">首页
	            </a></button>
	            </span>
	            {/if}
            {/if}
        </div>
        </div>
		<input type="hidden" name="times" id="times" value="{$times}" />
		 	<input type="hidden" name="one_limit" id="one_limit" value="{$goods['one_limit']}" />
		 	<input type="hidden" name="many_limit" id="many_limit" value="{$goods['many_limit']}" />
		 <input type="hidden" id="buytype" value="" />
	    <input type="hidden" id="buytype2" value="{$goods['groupnum']}" />
	    <input type="hidden" id="optionid" name="optionid" value=""/>
		<div id="cover"></div>
		<div id="guide" style="top: 15%;left: 4%;">
			{if intval($config['base']['group_style'])==0}
			<div onclick="$('#guide,#cover').fadeOut()" style="position: fixed;bottom: 3%;color: #000;left: 45%;font-size: 14px;width: 25px;height: 25px; border-radius: 50%;background: #fff;text-align: center;line-height: 25px;">X</div>
			<!--<div style="position: fixed;z-index:2002;top: 10%;left: 5%;background: #fff;padding:15px 10px;width: 90%;box-sizing: border-box">-->
				<!--<div style="font-size: 16px;font-weight: 600">{$_Session['btitle']}</div>-->
				<!--<div><img style="width:100%;margin: 5px 0" src="{$goods['gimg']}" alt=""/></div>-->
				<!--<div style="align-items: center;display: flex;-webkit-align-items: center;display: -webkit-flex;">-->
					<!--<div style="width: 80px;height: 80px;margin-right: 10px;"><img style="width: 100%;height: 100%" src="{php echo $createqrcode->createQrcode($tourl)}" alt=""/></div>-->
					<!--<div style="width: 70%">-->
						<!--<p><b>{php echo $config['share']['share_title']}</b></p>-->
						<!--<p>-->
							<!--<span style="font-size: 16px;font-weight: 600;color: #e4393c">￥{$goods['gprice']}</span>-->
							<!--<s>￥{$goods['mprice']}</s>-->
						<!--</p>-->
					<!--</div>-->
				<!--</div>-->
				<!--<div style="text-align: center;font-size: 12px;	color:#aaa;margin-top: 10px">截屏保存图片，长按识别二维码</div>-->
			<!--</div>-->
			<div class="canvasImg">
				<div id="imgBox" style="position: fixed;top:3%;"></div>
				<p style="text-align: center;text-align: center;position: fixed;bottom: 10%;color: #fff;width: 90%;">长按图片保存</p>
			</div>
			{else}
			<img src="{TG_URL_ARES}images/guide1.png">
			{/if}
		</div>
 	</div>
</div>
<div class="goods-rule" style="display:none;">
<div>
<div class="goods-rule-head">{$goods['gname']}</div>

<div id="productInfott">

	                    </div>
<div id="goods-know" style="background-color:#6fbfd8;">已了解</div>
</DIV>
</div>
<div class="link-rule" style="display:none;">
	<div> 
	{if $tuaninfo['selltype']==4}
	<div>阶梯团须知</div> 		
		<div>			
			<div style="color:#0894ec;">什么是阶梯团？</div>	
			<p>每个商品都有单独购买价和阶梯拼团价，当您通过拼团价购买时，开团支付成功后再邀请朋友参团，参团人数达到组团规定时，系统将阶梯差价应退款金额自动退款至您的微信钱包中，然后在家坐等包裹。在规定时间内，若人数不足整团规定人数，在活动时间截止时，系统自动识别当前阶梯价格将阶梯差价应退款金额自动退款至您的微信钱包中，然后在家坐等包裹。</p >	
			<div style="color:#0894ec;">如何拼团成功，并取得最低阶梯价？</div>	
			<p>阶梯团是基于好友的转发扩散，获取团购优惠，达到规定人数自动降价退款至微信钱包。首先选择商品开团：选择拼团商品下单，团即刻开启，但团长完成支付，方能获取转发链接，并在团开启规定时间内邀请到相应人数的好友支付，此团方能成功获得本次阶梯团最低价。</p >		
			<div style="color:#0894ec;">团长干嘛的？</div>		
			<p>首先选择心仪的商品下单，并完成支付后即为团长。团长视为本次交易的发起人，且为第一位支付成功的成员。</p >	
			<div style="color:#0894ec;">拼团成员是什么？</div>		
			<p>通过分享出去的该团入口进入或者通过分享团入口进入并完成付款加入该团的团员，参团成员也可以将该团分享出去邀约更多的团员参团。</p >
		</div>
		<div id="link-know">已了解</div>
		{elseif $goods['selltype']==3}
		<div>
			<div>自选团须知</div> 
			<div>
				<div style="color:#0894ec;">什么是自选团？</div>
				<p>每个商品都有单独购买价和拼团价，拼团价可设置多人多个不同的人数价格团，可以根据粉丝自己朋友的情况选择人数去开团。当您通过拼团价购买时，开团支付成功后再邀请朋友参团，参团人数达到组团规定时，订单生效。在规定时间内，若人数不足组团失败，我们会在48小时内自动退款。</p>
				<div style="color:#0894ec;">如何拼团成功？</div>
				<p>拼团是基于好友的转发扩散，获取团购优惠。首先选择商品开团：选择拼团商品下单，团即刻开启，但团长完成支付，方能获取转发链接，并在团开启规定时间内邀请到相应人数的好友支付，此团方能成功。</p>
				<div style="color:#0894ec;">团长干嘛的？</div>
				<p>首先选择心仪的商品下单，并完成支付后即为团长。团长视为本次交易的发起人，且为第一位支付成功的成员。</p>
				<div style="color:#0894ec;">拼团成员是什么？</div>
				<p>通过分享出去的该团入口进入或者通过分享团入口进入并完成付款加入该团的团员，参团成员也可以将该团分享出去邀约更多的团员参团。</p>
				<div style="color:#0894ec;">拼团失败是怎么回事？</div>
				<p>从团长开团规定时间内未能找到相应开团人数的好友参团，则该团失败，系统会在48个小时内自动原路退款至你的支付账户中。</p>
			</div>
			<div id="link-know">已了解</div>
		</div>
		{else if $tuaninfo['selltype']==6}
		<div>新专团须知</div> 
		<div>
			<div style="color:#0894ec;">什么是新专团？</div>
			<p>每个商品都有单独购买价和新用户专享价，当您通过拼团价购买时，开团支付成功后再邀请朋友参团，参团人数达到组团规定时，订单生效。在规定时间内，若人数不足组团失败，我们会在48小时内自动退款。新专团主要为未在商城购买过商品记录的用户去设立的一个专属团，新用户可以团长或者是团员，如已在商城下单的用户只能当团长</p>
			<div style="color:#0894ec;">如何拼团成功？</div>
			<p>拼团是基于好友的转发扩散，获取团购优惠。首先选择商品开团：选择拼团商品下单，团即刻开启，但团长完成支付，方能获取转发链接，并在团开启规定时间内邀请到相应人数的好友支付，此团方能成功。</p>
			<div style="color:#0894ec;">团长干嘛的？</div>
			<p>首先选择心仪的商品下单，并完成支付后即为团长。团长视为本次交易的发起人，且为第一位支付成功的成员。</p>
			<div style="color:#0894ec;">拼团成员是什么？</div>
			<p>通过分享出去的该团入口进入或者通过分享团入口进入并完成付款加入该团的团员，参团成员也可以将该团分享出去邀约更多的团员参团。</p>
			<div style="color:#0894ec;">拼团失败是怎么回事？</div>
			<p>从团长开团规定时间内未能找到相应开团人数的好友参团，则该团失败，系统会在48个小时内自动原路退款至你的支付账户中。</p>
		</div>
		<div id="link-know">已了解</div>
		{else}
		<div>拼团须知</div> 
		<div>
			<div style="color:#0894ec;">什么是拼团？</div>
			<p>每个商品都有单独购买价和拼团价，当您通过拼团价购买时，开团支付成功后再邀请朋友参团，参团人数达到组团规定时，订单生效。在规定时间内，若人数不足组团失败，我们会在48小时内自动退款。</p>
			<div style="color:#0894ec;">如何拼团成功？</div>
			<p>拼团是基于好友的转发扩散，获取团购优惠。首先选择商品开团：选择拼团商品下单，团即刻开启，但团长完成支付，方能获取转发链接，并在团开启规定时间内邀请到相应人数的好友支付，此团方能成功。</p>
			<div style="color:#0894ec;">团长干嘛的？</div>
			<p>首先选择心仪的商品下单，并完成支付后即为团长。团长视为本次交易的发起人，且为第一位支付成功的成员。</p>
			<div style="color:#0894ec;">拼团成员是什么？</div>
			<p>通过分享出去的该团入口进入或者通过分享团入口进入并完成付款加入该团的团员，参团成员也可以将该团分享出去邀约更多的团员参团。</p>
			<div style="color:#0894ec;">拼团失败是怎么回事？</div>
			<p>从团长开团规定时间内未能找到相应开团人数的好友参团，则该团失败，系统会在48个小时内自动原路退款至你的支付账户中。</p>
		</div>
		<div id="link-know">已了解</div>
		{/if}
	</div>
</div>


{if $tuaninfo['groupstatus']==3}
<script>  

$(document).ready(function(){
    function FreshTime(){
        var str ="{php echo date('Y-m-d H:i:s',$tuaninfo['starttime'])}";
		//alert('{php echo date('Y-m-d H:i:s',$tuaninfo['endtime'])}');
		var lasttime={php echo $tuaninfo['endtime']}-{php echo $tuaninfo['starttime']};
//		console.log(lasttime);
        str = str.replace(/-/g,"/");
        var starttime= new Date(str);//开始时间
        var nowtime = new Date();//当前 时间
        var now_time = nowtime.getTime();
        var start_time = starttime.getTime();
        var lefttime = lasttime-((now_time-start_time)/1000); //计算剩余时间\
		console.log((nowtime.getTime()-start_time)/1000);
        var bar_width =  (1-(lefttime/(lasttime)))*100+"%"; //计算进度条百分比
        if (lefttime > 0) {
            hh=parseInt((lefttime/3600));
            mm=parseInt((lefttime/60)%60);
            ss=parseInt(lefttime%60);
            $(".pp_time").html('剩余<span id="ti_time_hour">'+hh+'</span>:<span id="ti_time_min">'+mm+'</span>:<span id="ti_time_sec">'+ss+'</span>结束');

            $('#progressbar').css("width",bar_width);
        }
    }
    FreshTime();
    var sh;
    sh=setInterval(FreshTime,1000);
});
</script>

{/if}

<script>

	var options = {php echo json_encode($options)};
    var specs = {php echo json_encode($specs)};
    var hasoption = {php echo $goods['hasoption'] == '1' ? 'true' : 'false'};
	document.getElementById("productInfott").innerHTML=escapeHtml('{$goods['gdesc']}');
document.getElementById("link-know").onclick=function(){
		document.querySelector('.link-rule').style.setProperty("display","none");
	}
	document.getElementById("lookdetail").onclick=function(){
		document.querySelector('.link-rule').style.setProperty("display","block");
	}
document.getElementById("goods-know").onclick=function(){
		document.querySelector('.goods-rule').style.setProperty("display","none");
	}
	document.getElementById("goodsdetail").onclick=function(){
		document.querySelector('.goods-rule').style.setProperty("display","block");
	}
	function bb(b){
		var many_limit = $("#many_limit").val();
	    var one_limit = $("#one_limit").val();
	    var times = $("#times").val();
	    many_limit = parseInt(many_limit);one_limit=parseInt(one_limit);times=parseInt(times);
		if(b==1){
			location.href = "{php echo app_url('order/orderconfirm',array('groupnum'=>1));}";
		}else{
		if(many_limit>=1){
	        		if(times >= many_limit){
		        		$.toast('单人购买总数为：'+many_limit+',您已购买'+times);
						return false;
		        	}
	        	}
			var nn = "{$goods['groupnum']}";
			location.href = "{php echo app_url('order/orderconfirm')}" + "&groupnum=" + nn;
		}
	}
	
    $("#num").blur(function(){
		var inputnum=$("#num").val();
		var marketprice = 0;
	    var productprice = 0;
		var options = {php echo json_encode($options)};
		
		var ret = option_selected();
	    var len = options.length;
	        for (var i = 0; i < len; i++) {
	            var o = options[i];
	            var ids = ret.all.join("_");
	            if (o.specs == ids) {
	                optionid = o.id;
	                stock = o.stock;
	                marketprice = o.marketprice;
	                productprice = o.productprice;
	                break;
	            }
	        }
	    if(marketprice==0){
	     	marketprice = "{php echo $goods['gprice']}";
	    }
		var goodsPrice=marketprice;
		var totalPrice = goodsPrice*inputnum;
		totalPrice = totalPrice.toFixed(2);
		$("#option_gprice").html(totalPrice);
	});
	
	$("#up").bind('click',function(){
		var num = $('#num').val();
			num = parseInt(num)+1;
			$('#num').val(num);
		var marketprice = 0;
	    var productprice = 0;
		var options = {php echo json_encode($options)};
		var ret = option_selected();
	    var len = options.length;
	        for (var i = 0; i < len; i++) {
	            var o = options[i];
	            var ids = ret.all.join("_");
	            if (o.specs == ids) {
	                optionid = o.id;
	                stock = o.stock;
	                marketprice = o.marketprice;
	                productprice = o.productprice;
	                break;
	            }
	        }
	     if(marketprice==0){
	     	marketprice = "{php echo $goods['gprice']}";
	     }
		var goodsPrice=marketprice;
		var inputnum=num;
		var totalPrice = goodsPrice*inputnum;
		totalPrice = totalPrice.toFixed(2);
		$("#option_gprice").html(totalPrice);
	});
	
	$("#down").bind('click',function(){
		var num = $('#num').val();
		num = parseInt(num)-1;
		if(num<=0){
			num=1;
		}
		$('#num').val(num);
		var marketprice = 0;
	    var productprice = 0;
		var options = {php echo json_encode($options)};
		var ret = option_selected();
	    var len = options.length;
	        for (var i = 0; i < len; i++) {
	            var o = options[i];
	            var ids = ret.all.join("_");
	            if (o.specs == ids) {
	                optionid = o.id;
	                stock = o.stock;
	                marketprice = o.marketprice;
	                productprice = o.productprice;
	                break;
	            }
	        }
	     if(marketprice==0){
	     	marketprice = "{php echo $goods['gprice']}";
	     }
		var goodsPrice=marketprice;
		var inputnum=num;
		var totalPrice = goodsPrice*inputnum;
		totalPrice = totalPrice.toFixed(2);
		$("#option_gprice").html(totalPrice);
	});

   $("#num2").blur(function(){
	var inputnum=$("#num2").val();
	var gp=$("#gn").val();
		gp = inputnum * gp;
		$("#option_price").html(gp);
	});
	
	$("#up2").bind('click',function(){
		var num = $('#num2').val();
			num = parseInt(num)+1;
			$('#num2').val(num);
		var gp=$("#gn").val();
			gp = num * gp;
			$("#option_price").html(gp);
	});
	
	$("#down2").bind('click',function(){
		var num = $('#num2').val();
		num = parseInt(num)-1;
		if(num<=0){
			num=1;
		}
		$('#num2').val(num);
		var gp=$("#gn").val();
			gp = num * gp;
			$("#option_price").html(gp);
	});

    var options = {php echo json_encode($options)};
    var specs = {php echo json_encode($specs)};
    var hasoption = {php echo $goods['hasoption'] == '1' ? 'true' : 'false'};
	
    var selected = [];
    function option_selected() {
        var ret = {
            no: "",
            all: []
        };
        if (!hasoption) {
            return ret;
        }
        $(".optionid").each(function () {
            ret.all.push($(this).val());
            if ($(this).val() == '') {
//                ret.no = $(this).attr("title");
                ret.no = $(this).html();
                return false;
            }
        })
        return ret;
    }
	
	function closechoose(){
		$('.footer').show();
        $('.good_choose_layer').fadeOut(100);
		$('.good_choose').fadeOut(100); 
    }

	function exchange(numb) {
		$('#div_nav .boxx .sp').removeClass('on');
		$('.section_specification').removeClass('on');
		$('.section_detail').removeClass('on');
		$('a#shangpin'+numb).addClass('on');
		if(numb==0) {
			$('.section_specification').addClass('on');
		}else{
			$('.section_detail').addClass('on');
		}
	}
	
	function showStores(obj){
        if($(obj).attr('show')=='1'){
            $(obj).next('div').slideUp(100);
            $(obj).removeAttr('show').find('i').removeClass('fa-angle-down').addClass('fa-angle-up');
        }else{
            $(obj).next('div').slideDown(100);
            $(obj).attr('show','1').find('i').removeClass('fa-angle-up').addClass('fa-angle-down');
        }
    }

</script>
<script type="text/javascript">
	var _system={
		$:function(id){return document.getElementById(id);},
		_client:function(){
			return {w:document.documentElement.scrollWidth,h:document.documentElement.scrollHeight,bw:document.documentElement.clientWidth,bh:document.documentElement.clientHeight};
		},
		_scroll:function(){
			return {x:document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft,y:document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop};
		},
		_cover:function(show){
			if(show){
				this.$("cover").style.display="block";
				this.$("cover").style.width=(this._client().bw>this._client().w?this._client().bw:this._client().w)+"px";
				this.$("cover").style.height=(this._client().bh>this._client().h?this._client().bh:this._client().h)+"px";
			}else{
				this.$("cover").style.display="none";
			}
		},
		_guide:function(click){
			this._cover(true);
			this.$("guide").style.display="block";
			this.$("guide").style.top=(_system._scroll().y+5)+"px";
			window.onresize=function(){_system._cover(true);_system.$("guide").style.top=(_system._scroll().y+5)+"px";};
			if(click){_system.$("cover").onclick=function(){
				_system._cover();
				_system.$("guide").style.display="none";
				_system.$("cover").onclick=null;
				window.onresize=null;
			};}
		},
		_zero:function(n){
			return n<0?0:n;
		}
	}

	//canvas 图片合成
	//canvas 图片合成
	function hecheng(){
		draw(function(){
			document.getElementById('imgBox').innerHTML='<img crossOrigin="Anonymous" src="'+base64[0]+'">';
		})
	}


	var data=[{if empty($goods['share_image'])}"{php echo saveImage(tomedia($goods['gimg']))}"{else}"{php echo $goods['share_image']}"{/if},"{php echo $createqrcode->createQrcode($tourl)}"],base64=[];

	function draw(fn){
		var c=document.createElement('canvas'),
				ctx=c.getContext('2d'),
				len=data.length;
		c.width=screen.width-30;
		c.height=(c.width-10)+125;
		ctx.rect(0,0,c.width,c.height);
		ctx.fillStyle='#fff';

		ctx.fill();
		function drawing(n){
			if(n<len){

				var img=new Image;
				//img.crossOrigin = 'Anonymous'; //解决跨域
				img.src=data[n];
                img.setAttribute('crossOrigin', 'anonymous'); // works for me
				img.onload=function(){
					if(n==0){

						ctx.drawImage(img,5,5,c.width-10,(c.width-10));//距 left  top  width   height
					}else{
						ctx.drawImage(img,0,(c.width-10)+5,120,120);
						var heighta=(c.width-10)+110;
//						title
						ctx.font="400 16px Arial";
						ctx.fillStyle="#101010";
						ctx.lineWidth=2;
						var str="{$config['share']['share_title']}";
						var lineWidth = 0;
						var initHeight=(c.width-10)+30;//绘制字体距离canvas顶部初始的高度
						var lastSubStrIndex= 0; //每次开始截取的字符串的索引
						//ctx.fillText(str,80,180);//left  top
						for(var i=0;i<str.length;i++){
							lineWidth+=ctx.measureText(str[i]).width+1.5;
							if(lineWidth>(c.width-100)){
								ctx.fillText(str.substring(lastSubStrIndex,i),115,initHeight);//绘制截取部分
								initHeight+=20;//20为字体的高度
								lineWidth=0;
								lastSubStrIndex=i;
							}
							if(i==str.length-1){//绘制剩余部分
								ctx.fillText(str.substring(lastSubStrIndex,i+1),115,initHeight);
							}
						}

						//oprice
						ctx.font="400 16px Arial";
						ctx.fillStyle="#e4393c";
						ctx.fillText("￥{$goods['gprice']}",115,heighta);//left  top

						//mprice
						ctx.font="italic 400 14px Arial";
						ctx.fillStyle="#aaa";
						ctx.fillText("￥{$goods['mprice']}",195,heighta);//left  top

					}
					drawing(n+1);//递归
				}
			}else{
				//保存生成作品图片
                try{
                    base64.push(c.toDataURL("image/jpeg",1));

                        fn();
                } catch (error) {
                    console.log(error);
                }


			}
		}
		drawing(0);
	}


//数量团加减
	$('.tuan_num .minus').click(function(){
		var valuea=Number($('.tuan_num input').val());
		if(valuea<=1){
			return;
		}
		$('.tuan_num input').val(--valuea);
	});

	$('.tuan_num .add').click(function(){
        var maxNum=Number($('.pinTuanJia li:last-child').attr('data-id'));
        var valuea=Number($('.tuan_num input').val());
        if(valuea>=maxNum){
            $.toast('已达最大购买数量');
            return;
        }
        $('.tuan_num input').val(++valuea);
	});

	$('a.cantuan_num').click(function(){
        var nowNum=Number("{$nownum}");
        var maxNum=Number($('.pinTuanJia li:last-child').attr('data-id'))-nowNum;
        var valuea=Number($('.tuan_num input').val())||0;
        if(valuea>maxNum){
            $.toast('您最多可购买'+maxNum+'件');
            return;
        }
		var num='';
		if("{$goods['is_amount']}"=='1'){
			num='&num='+$('.tuan_num input').val()
		}
		location.href="{php echo app_url('order/orderconfirm',array('id' => $goods['id'],'tuan_id' => $tuan_id,'groupnum'=>$tuaninfo['neednum']));}"+num;
	});
	//数量团，并且参团的时候显示  数量选择div
	if($('.bottombutton').html()!='我要参团'){
		$('.tuan_num').css('display','none');
	}
	if($('.address_new button').html()=='团购已成功,点击新开一团'){
		$('.tuan_num').css('display','block');
	}

	function goNewtuan(){
		var num='';
		if("{$goods['is_amount']}"=='1'){
			num='&num='+$('.tuan_num input').val()
		}
		location.href="{php echo app_url('order/orderconfirm',array('groupnum'=>$goods['groupnum'],'id'=>$goods['id'],'newtuan'=>'newtuan'));}"+num;
	}
	function escape2Html(str){
        var arrEntities={'lt':'<','gt':'>','nbsp':' ','amp':'&','quot':'"'};
        return str.replace(/&(lt|gt|nbsp|amp|quot);/ig,function(all,t){return arrEntities[t];});
    }
	
	{if $goods['selltype']==5}
    $(".editor").html('{$goods["luckcontent"]}'+escape2Html("{$goods['goodsdesc']}"));

	{else}
		$(".editor").html(escape2Html("{$goods['goodsdesc']}"));
	{/if}
	
	
	
</script>

<script type="text/javascript"> 

	$(document).ready(function () {
		$(".bottombutton").click(function () {
//	  $(".close").hide();
			{if $result['statustype'] == 1 &&$tuaninfo['selltype']==6}
	  			$.alert("感谢您的支持，新专团模式您可享受团长待遇，点击下方按钮开团！");
			{/if}
			$(".open").show();
		});

	});

    $('.fixRT').remove();
	{if !empty($myorder)&&$tuaninfo['groupstatus']==3}
	    $('.bottombutton').click();
	{/if}

    {if intval($storeid)}
        sessionStorage.setItem('storeid',{$storeid});
    {/if}
</script>
{php include wl_template('common/footer');}