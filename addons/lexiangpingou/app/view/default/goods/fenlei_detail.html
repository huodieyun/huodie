
{php include wl_template('common/header');}
<style>
    .ul_1{
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        display: -webkit-flex;
        -webkit-flex-wrap: wrap;
        -webkit-justify-content: space-between;
    }
    .noData{padding-top: 0}
    .preloader-indicator-modal{
        display: none!important;
    }
    .fenleiFST{
        position: fixed;
        width: 100%;
        top: 42px;
        left: 0;
        box-sizing: border-box;
        z-index: 20000;
        color: #101010;
        background: #fff;
        border-bottom: 1px solid #e5e5e5;
    }
    .fenleiFST>ul{
        overflow-y: hidden;
        overflow-x: auto;
        white-space: nowrap;
    }
    .fenleiFST li{
        margin-left: 10px;
        padding: 5px 0;
        display: inline-block;
    }
    .fenleiFST li.active{
        border-bottom: 2px solid #ed5111;
        color: #ed5111;
    }

    .listCon h5{
        padding: 0;
        font-size: 14px;
        height: 41px;
        overflow: hidden;
    }
    .listCon li{
        width: 49%;
        display: inline-block;
        margin: 0;
    }
    .fnZone{
        margin: 0;
        height: 30px;
        line-height: 30px;
        margin-left:5px;
        background-color:transparent;
        color:#e4393c;
    }
	.fnZone .iconal-gouwuche{
        background: inherit;
    }
    .input-search{
        height:3em; overflow:hidden;padding:10px;
        background: #ed5111;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        box-sizing: border-box;
        z-index: 20000;
    }
    .input-search span{position:absolute; left:3em; right:3em; border:1px solid #eee;
        -webkit-border-radius:  0;
        -moz-border-radius: 0;
        border-radius: 3px;background-color: #fff;
        top:6px;
    }
    .input-search span input{
        width:100%; height:25px;
        font-size:12px; border:1px solid #fcfcfc; padding:0 0.6em; box-sizing:border-box;  border:none;
        border-radius:3px;
    }
    .input-search button{
        width:3.6em; height:37px;  background:transparent!important; display:block; position:absolute; right:-7px;top:0px; border-radius: 0;
        border:none;
    }
    .input-search button i{color:#fff; font-size:16px;}
    .content{
        top:42px;
    }
</style>
{if $config['base']['meiqia']>0}
<script type='text/javascript'>
    (function(m, ei, q, i, a, j, s) {
        m[a] = m[a] || function() {
            (m[a].a = m[a].a || []).push(arguments)
        };
        j = ei.createElement(q),
            s = ei.getElementsByTagName(q)[0];
        j.async = true;
        j.charset = 'UTF-8';
        j.src = i + '?v=' + new Date().getUTCDate();
        s.parentNode.insertBefore(j, s);
    })(window, document, 'script', '//static.meiqia.com/dist/meiqia.js', '_MEIQIA');
    _MEIQIA('entId', {$config['base']['meiqia']});
</script>
{/if}
{if $miaoxianfunction['status']}
<div id="link-logo" style="width:100%;height:100%;transition-property:height opacity;transition-duration:0.5s;background-color:white;transition-timing-function:ease-out;position:fixed;left:0px;top:0px;z-index:100008;display:none;color:white">
    <img src="{if !empty($acct['homeimg'])}{php echo tomedia($acct['homeimg']);}{else}{TG_URL_ARES}images/sylg2.png{/if}" alt="首页logo" style="border:1px solid black;width:100%;height:100%;">
    <div id="link-see" style="display:none;position:absolute;left:0;right:0;bottom:60px;margin:auto;width:100px;height:35px;background-color:#6fbfd8;border-radius:5px;line-height:35px;text-align:center;">进去看看</div>
</div>

<script>
    if (! sessionStorage.getItem('miao')){
        var linklogo = document.getElementById("link-logo");
        linklogo.style.setProperty("display","block");
        setTimeout( function () {
            linklogo.style.setProperty("opacity","0");
            setTimeout( function() {linklogo.style.setProperty("display","none");},500);
            sessionStorage.setItem("miao","1");
        },1500)
    }
</script>
{/if}
<div class="input-search">
    <span>
        <input name="keywords" type="search" placeholder="请输入搜索关键词！" id="keywordBox" value="{$_GPC['keyword']}">
    </span>
    <button id="submit" value="搜索"><i class="iconal-sousuo"></i></button>
</div>
<!--二级分类-->
<div class="allFL" style="display: none;position: fixed;background: rgba(0,0,0,0.7);z-index: 20010;width: 100%;height: 100%;">
    <h2 onclick="$('.allFL').slideUp()" style="background: #e9e9e9;color: #818181;padding: 10px;">全部分类 <i style="font-size:12px;position: absolute;right: 10px" class="iconal-xiangshangjiantou"></i></h2>
    <div class="j-rmd-types rmd-types">
        <!--<a href="{php echo app_url('goods/list/display', array('gid' => $itme['id']));}" onclick="sessionStorage.removeItem('position');" class="external">-->
        <!--<img src="{php echo tomedia($itme['thumb']);}" alt="">-->
        <!--<span>{$itme['name']}</span>-->
        <!--</a>-->
    </div>
    <div onclick="$('.allFL').slideUp()" style="width: 100%;height: 100%;"></div>
</div>
<!--一级分类-->
<div class="fenleiFST">
    <ul>
        <li data-href="{php echo app_url('goods/list/display')}">首页</li>
        {loop $category $itme}
        <li data-idFst="{$itme['id']}" data-href="{if $itme['url']==''}{php echo app_url('goods/list/fenlei_detail', array('gid' => $itme['id']));}{else}{$itme['url']}{/if}">{$itme['name']}</li>
        {/loop}
    </ul>
</div>
<div class="page-group" style="">
    <div class="page page-current" id="page-goods-list">

        <div class="content infinite-scroll native-scroll" data-distance="10">
            <div class="topbar"><h3 class="title">乐享拼购</h3><div class="barfn"><i class="refresh"></i><i class="share"></i></div></div>
            {php include wl_template('common/followed');}
            <div id="banner" style="height: 35px"></div>
            {if $category}
            <div class="j-rmd-types rmd-types">
                <!--{loop $category $itme}-->
                <!--<a href="{php echo app_url('goods/list/display', array('gid' => $itme['id']));}" onclick="sessionStorage.removeItem('position');" class="external">-->
                <!--<img src="{php echo tomedia($itme['thumb']);}" alt="">-->
                <!--<span>{$itme['name']}</span>-->
                <!--</a>-->
                <!--{/loop}-->
                <!--{if $a==7}-->
                <!--<a href="javascript:;" class="external" onclick="$('.allFL').slideDown()">-->
                <!--<i class="iconal-dian" style="width: 40px; height: 40px;background: #ddd;display: block;text-align: center;line-height: 40px;color: #fff;font-size: 1.5em;border-radius: 50%;margin: 0 auto 12px;"></i>-->
                <!--<span>查看全部</span>-->
                <!--</a>-->
                <!--{/if}-->
            </div>
            {/if}
            <div class="appCode" style="display: none;">
                <div class="codeBox imgShow">
                    <img src="" alt="">
                </div>
                <div class="codeBox codeRight">
                    <p><i></i><span class="des"></span></p>
                    <div class="inputZone">
                        <div style="display: inline-block;float: left;width:70%;">
                            <input type="text" placeholder="" id="codeInput">
                        </div>
                        <div style="display: inline-block;width:30%">
                            <span class="codeBtn">确认</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="list" id="orderlist">
                <div class="listCon">
                    <ul class="ul_1">
                    </ul>
                </div>
                <div class="loading_more" style="padding-top: 10px;display: none;font-size:1.2em;font-weight:bold;"><span class="loading"><i class="icon_load"></i>正在玩命的加载中......</span>
                </div>

                <div class="error">加载失败，点击重新加载</div>

                <div class="noData" style="font-size:1.0em;color:#c3c3c3;">
                    全部数据加载完毕
                    {if !$banquanfunction['status']}	<div><a href="http://www.lexiangpingou.cn"><img src="{TG_URL_ARES}images/bbb.png" width="40%"></a><div>火蝶科技技术热线:400-626-1079</div></div>{/if}
                </div>

            </div>
            <div class="mask"></div>
        </div>
    </div>
</div>
{php include wl_template('common/footerbar');}
<div id="gotop" style="display:none;position:fixed;right:10px;bottom:60px;width:45px;height:45px;border-radius:50%;z-index:10086;background-color:c3c3c3;">
    <img src="{TG_URL_ARES}images/gotop.png" width="45px" height="45px">
</div>
<!--<div id="animationS" style="display:none;background-color:hsl(240, 19%, 95%);width:100%;height:100%;left:0px;bottom:0px;position:fixed;-->
<!--z-index:10000000">-->
<!--<img src="{if !empty($acct['homeimg'])}{php echo tomedia($acct['homeimg']);}{else}{/if}" style="width:100%;height:100%;">-->
<!--<div class="preloader-indicator-modal" style="position:fixed;left:0px;right:0px;bottom:50px;margin:auto;width:84px;height:84px;" >-->
<!--<span class="preloader preloader-white"></span>-->
<!--</div>-->
<!--</div>-->
<script type="text/html" id="goodslist">
    {{# for(var i = 0, len = d.list.length; i < len; i++){ }}
    <li class="gli" style="position:relative;">
        <a href="{{ d.list[i].a }}" class="external externals" id="{{ d.list[i].id }}" onclick="sesso(this)" >
            <img class="noneimg" src="{TG_URL_ARES}images/noneRed.png" alt="" style="display: none;position:absolute;width:100px;z-index: 2;left: calc(50% - 50px);top: 50px;">
            <div class="img"><img src="{{ d.list[i].share_image }}" alt="" style="opacity: 1;"><div class="icon_position">{if $config['base']['iszhe']==0}<div class="discount"><span>{{ Math.round((d.list[i].gprice/d.list[i].mprice)*10) }}折<br>{{ d.list[i].groupnum }}人团</span></div>{/if}
                {{# if(d.list[i].goodstab != null && typeof(d.list[i].goodstab.length) != "undefined" && d.list[i].goodstab){ }}
                <!--<div class="pricedown">{{ d.list[i].goodstab }}</div>-->
                {{# } }}
            </div>
                {{# var lenn = d.list[i].params.length; if(lenn >= 3){ }}
                <ul class="desPos">
                    <li class="firstLine " expos="0">{{ d.list[i].params[0].value }}</li>
                    <li class="" expos="0">{{ d.list[i].params[1].value }}</li>
                    <li class="lastLine" expos="0">{{ d.list[i].params[2].value }}</li>
                </ul>
                {{# } }}
            </div>
            <div class="txt"><h5>{{ d.list[i].gname }}</h5><p style="display: none">	{{# if(d.list[i].indexdesc != null ){ }}{{ d.list[i].indexdesc }}{{# } }}</p></div>
            <div class="fnWrap" >
                <div class="fnZone"><i style="display: none"></i>
                    <span><b class="people" style="display: none;{{# if(d.list[i].selltype==7){ }}display:none{{# } }}">{{ d.list[i].groupnum }}人团</b><b class="price">{{# if( d.list[i].selltype==1||d.list[i].selltype==2||d.list[i].selltype==5||d.list[i].selltype==6){ }}￥{{ d.list[i].gprice }}{{# } }}{{# if( d.list[i].selltype==0||d.list[i].selltype==3||d.list[i].selltype==4||d.list[i].selltype==7){ }}￥{{ d.list[i].oprice }}{{# } }}</b></span>
                    <span style="font-size: 12px;color: #aaa;float: right;">
                        {{# if(d.list[i].selltype!=0){ }}
                            已团 {{ d.list[i].salenum }} {{ d.list[i].unit }}
                        {{# } }}
                        {{# if(d.list[i].selltype==0){ }}
                            <i class="iconal-gouwuche"></i>
                        {{# } }}
                    </span>

                    <span class="btn" style="display:none;position:relative;width:100px;height:35px;line-height: 35px;background-color:#e4393c;color:#fff;border-radius: 4px;text-align: center">
		<span class="isshow" style="display:none;">{{ d.list[i].isshow }}</span>
		<span class="isupjia" style="display:none;">{{ d.list[i].isupjia }}</span>
		<span class="typenotice">{{# if( d.list[i].selltype==1){ }}随意团{{# } }}
		{{# if( d.list[i].selltype==2){ }}邻购团{{# } }}
		{{# if( d.list[i].selltype==0){ }}单买{{# } }}
		{{# if( d.list[i].selltype==3){ }}
		自选团
		{{# } }}
		{{# if( d.list[i].selltype==4){ }}
		阶梯团
		{{# } }}
		{{# if( d.list[i].selltype==5){ }}
		抽奖团
		{{# } }}

		{{# if( d.list[i].selltype==6){ }}
		新专团
		{{# } }}
				{{# if( d.list[i].selltype==7){ }}
		订金团
		{{# } }}
		</span>
		<span style="position: absolute;top:-1px;margin-left: 5px">&gt;</span>
		</span>
                </div>
            </div>
            <div class="kucun" style="display:none;">{{ d.list[i].gnum }}</div>
        </a>
        <span class="noticeup" onclick="notice(this)" style="position:absolute;background-color:rgba(0,0,0,0);left:200px;bottom:10px;width:100px;height:40px;display:none;"></span>
    </li>

    {{# } }}
</script>
<script>
    console.log('多商户分类 fenlei_detail');
    //触屏优化
    var content = document.getElementsByClassName("content")[0];
    content.addEventListener("touchmove", function (ev) {
        ev.stopImmediatePropagation();
    }, false);
    content.addEventListener("touchstart", function (ev) {
        ev.stopImmediatePropagation();
    }, false);
    content.addEventListener("touchend", function (ev) {
        ev.stopImmediatePropagation();
    }, false);
    var selectGuige =document.getElementById("selectGuige");
    var guigeDetail = document.getElementById("guigeDetail");
    var Guige = JSON.parse(sessionStorage.getItem("Sguige")) || {};//存放商品规格,如果有数据直接从缓存提取，加快加载速度
    var linshi = null;//存放临时变量，用于函数间的传递
    //定义各种ajax的url
    var urlclear = "{php echo app_url('goods/list/clear')}";
    var urladd = "{php echo app_url('goods/list/add')}";
    var urlRemove = "{php echo app_url('goods/list/remove')}";
    var urlNotice = "{php echo app_url('goods/list/notice')}";
    var urlNoticeRemove = "{php echo app_url('goods/list/noticeremove')}";
    var Buy = {};//存放购买数据
    var GuigeSelect = {};//存放购买商品的规格
    var User = JSON.parse(localStorage.getItem("user"))|| {};//进入是否有数据，存放用户的个人信息，比如上架通知等
    //定义各种控件
    var cartDetails = document.getElementById( "cartDetails" );
    var goPay = document.getElementById( "goPay" );
    var buycart = document.getElementById( "buycart" );
    var guige = document.getElementsByClassName("isguige");
    var guigeimg = document.getElementById("guigeimg");
    var sesso;//传递事件函数，定义在全局中有助于传递
    var orderlist = document.getElementById("orderlist");
    //如果这个参数是false，那么无法操作
    //	var isPost = true;
    var Guigein = JSON.parse(sessionStorage.getItem("guigein"))|| {};//存放已经购买的规格，
    var num=0;
    var thispage = 1;
    var loading = false;
    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return decodeURI(r[2]); return null;
    }
    $(function() {
        sessionStorage.removeItem('ejID');
        'use strict';
        //商品列表页
        $(document).on("pageInit", "#page-goods-list", function(e, id, page) {

            var thispagesize = 6;
            var thispagesizemax = 100;

            function addItems(thispage, thispagesize) {
                sessionStorage.setItem('thispage',thispage);
                var ajaxurl = "{php echo app_url('goods/list/ajax',array('cid' => $_GPC['gid'],'ishunda'=>'1','keyword'=>$_GPC['keyword']))}" + "&page=" + thispage + "&pagesize=" + thispagesize;
                $.ajax({
                    type: "POST",
                    url: ajaxurl,
                    dataType: 'json',
                    beforeSend: function(XMLHttpRequest) {},
                    success: function(data) {
                        console.log(data);
                        thispagesizemax = data.total;
                        if (data.list.length > 0) {
                            var gettpl = document.getElementById('goodslist').innerHTML;
                            laytpl(gettpl).render(data, function(html){
                                $(".ul_1").append(html);
                            });
                        } else {
                            $(".loading_more").remove();
                            $('.noData').show();
                        }
                        joinSession();
                        setSealout();
                    },
                    error: function() {
                        $('.error').show();
                    }
                });
            }
            if(getQueryString('ejid')){
                ejHtml(getQueryString('ejid'),thispage,thispagesize);
                sessionStorage.setItem('ejID',getQueryString('ejid'));
            }else {
                addItems(thispage, thispagesize);
            }
            $(page).on('infinite', function() {
                if (loading) return;
                loading = true;
                $(".loading_more").show();
                if (orderlist.getBoundingClientRect().top < -600){
                    gotop.style.setProperty("display", "block");
                }else {
                    gotop.style.setProperty("display", "none");
                }
                setTimeout(function() {
                    loading = false;
                    thispage++;
                    if(sessionStorage.getItem('ejID')){
                        ejHtml(sessionStorage.getItem('ejID'),thispage,thispagesize,'','append');
                    }else {
                        addItems(thispage, thispagesize);
                    }
//                    $(".loading_more").hide();
                    $.refreshScroller();
                }, 300);
            });
            sesso=function sessionProcess(elem) {
                var externals = document.getElementsByClassName("externals");
                var len = externals.length;
                for ( var i = 0; i < len; i++ ) {
                    if ( elem === externals[i] ) {
                        var classclassname = elem.className.slice(9);
                        sessionStorage.setItem("position", classclassname+i.toString());
                        sessionStorage.setItem("id", externals[i].id);
                        sessionStorage.setItem("weight", externals[i].getElementsByClassName('weight')[0].innerHTML);
                        sessionStorage.setItem("kucun", externals[i].getElementsByClassName('kucun')[0].innerHTML);
                        sessionStorage.setItem("isGuige", externals[i].getElementsByClassName("isguige")[0].innerHTML);
                        sessionStorage.setItem("price", externals[i].getElementsByClassName("price")[0].innerHTML.slice(1));
                        sessionStorage.setItem("img", externals[i].getElementsByTagName("img")[1].src);
                        sessionStorage.setItem("title", externals[i].getElementsByTagName("h5")[0].innerHTML);
                        saveSession();
                    }
                }

            };
            if (sessionStorage.getItem("position") !== null){
                document.getElementById("animationS").style.setProperty("display","block");
                setTimeout(function() {
                    var classname = sessionStorage.getItem("position").slice(-1*sessionStorage.getItem("position").length,-1*sessionStorage.getItem("position").length+9);
                    var index = parseInt(sessionStorage.getItem("position").slice(-1*sessionStorage.getItem("position").length+9));
                    var i = index;
                    var n = ( i /4 +2 )* 500;
                    setTimeout(function(){
                        loadData(i);
                        setTimeout(function(){
                            document.getElementsByClassName(classname)[index].scrollIntoView();
                            setTimeout(function(){
                                document.getElementById("animationS").style.setProperty("display","none");
                            },0)
                        },n)
                    },200)
                },0);
            }
            function loadData(i) {
                if (i<3) return;
                thispage++;
                addItems(thispage,thispagesize);
                setTimeout(function(){
                    loadData(i-4);
                },200)

            }
        });
        $.init();
    });
    function setSealout() {
        var buys = document.getElementsByClassName("btn");
        var noneimg = document.getElementsByClassName("noneimg");
        var kuncuns = document.getElementsByClassName("kucun");
        var ids = document.getElementsByClassName("externals");
        var isshow = document.getElementsByClassName("isshow");
        var isupjia = document.getElementsByClassName("isupjia");
        var typenotice=document.getElementsByClassName("typenotice");
        for (var i = num; i < buys.length; i++) {
            if (Number(kuncuns[i].textContent) < 1 || Number(isshow[i].textContent) == 3){
                if (Number(isupjia[i].textContent) == 1){
                    buys[i].parentNode.style.lineHeight = "12px";
                    buys[i].style.fontSize = "12px";
                    if (User[ids[i].id]){
                        buys[i].parentNode.style.backgroundColor = "#fcc602"
                        buys[i].innerHTML = '等待通知';
                    }
                    else{
                        buys[i].parentNode.style.backgroundColor = "#fff";
                        buys[i].parentNode.style.fontSize = "14px";
                        buys[i].parentNode.style.lineHeight = "36px";
//						buys[i].innerHTML = '上架通知';
                        typenotice[i].innerHTML = '上架通知';
                    }
                }
                else {
                    typenotice[i].innerHTML = '售罄';
                    buys[i].style.fontSize = "20px";
                    noneimg[i].style.display = 'block';
                }
            }
        }
        num+=4;
    }
    function saveSession() {
        sessionStorage.setItem("Buy", JSON.stringify(Buy));
        sessionStorage.setItem("GuigeSelect",JSON.stringify(GuigeSelect));
    }
    defaultLoad();
    //根据sesion值加载初始数据
    function defaultLoad() {
        if (sessionStorage.getItem("Buy") ===null||sessionStorage.getItem("Buy")==='{}') {
        }else {
            updataCar();
            if (sessionStorage.getItem("Buy") != null) {
                Buy = JSON.parse(sessionStorage.getItem("Buy"));
            }
            if (sessionStorage.getItem("GuigeSelect") != null) {
                GuigeSelect = JSON.parse(sessionStorage.getItem("GuigeSelect"));
            }
        }
    }

    //下拉加在商品的时候，判断已购买有的id与下拉的id是否一致，如果一致，那么将数据整合
    function joinSession() {
        var externals = document.getElementsByClassName("externals");
        var extlen = externals.length;
        for (var key in Buy) {
            if (key == '999'){
                for (var i = 0; i < extlen; i++) {
                    if (Buy[key]['id'] == externals[i].id){
                        if (Buy[i] == undefined){
                            Buy[i] = Buy[key];
                        }
                        else {
                            Buy[i]['num'] += Buy[key]['num'];
                        }
                        if ( Number(i) !== Number(key)){
                            delete Buy[key];
                        }
                        if (Number(externals[i].getElementsByClassName("isguige")[0].innerHTML)<1){
                            return;
                        }
                        else {
                            if (GuigeSelect[i] == undefined) {
                                GuigeSelect[i] = GuigeSelect[key]
                                if ( Number(i) !== Number(key)){
                                    delete GuigeSelect[key];
                                }
                                return;
                            }
                            else {
                                var asray = [];
                                for (var a in GuigeSelect[key]) {
                                    asray.push[a];
                                }
                                var guigeArray = asray.filter(function(item, index, array) {
                                    return !( /.*Price/.test(item) || /.*Stock/.test(item) || /.*Weight/.test(item));
                                });
                                for (var j = 0; j < guigeArray.length; j++) {
                                    if (GuigeSelect[i][guigeArray[j]] == undefined) {
                                        GuigeSelect[i][guigeArray[j]] = GuigeSelect[key][guigeArray[j]];
                                        GuigeSelect[i][guigeArray[j] + "Stock"] = GuigeSelect[key][guigeArray[j] + "Stock"];
                                        GuigeSelect[i][guigeArray[j] + "Price"] = GuigeSelect[key][guigeArray[j] + "Price"];
                                        GuigeSelect[i][guigeArray[j] + "Weight"] = GuigeSelect[key][guigeArray[j] + "Weight"];
                                    }
                                    else {
                                        GuigeSelect[i][guigeArray[j]] += GuigeSelect[key][guigeArray[j]];
                                    }
                                }
                                if ( Number(i) !== Number(key)){
                                    delete GuigeSelect[key];
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    //计算买的总数量，并且更新总购买价格
    function totalNum() {
        var totalnum = document.getElementById('totalnum');
        var num=0;
        for (var key in Buy) {
            if (Buy[key]['num'] !== undefined) {
                num += Number(Buy[key]['num']);
            }
        }
        totalnum.innerHTML = parseInt(num);
        if (num == 0) {
            totalnum.style.setProperty('display', 'none');
        }
        else if (num > 0) {
            totalnum.style.setProperty('display', 'block');
        }
    }

    //点加，如果有规格跳选择规格，没有直接加减
    function plusNumber(ev) {
        var bprice=$(ev).parent().find('b.price');
        if(bprice.html().slice(0,1)==='￥')bprice.attr('data-price',bprice.html());
        var kucun=$(ev).parent().find('div.kucun').html();
        var isshow=$(ev).parent().find('span.isshow').html();
        var isguige=$(ev).parent().find('div.isguige').html();
        var evid=$(ev).parent().children('a').attr('id');
        var minus = ev.parentNode.getElementsByClassName('minus')[0];
        var goods = ev.parentNode.getElementsByTagName('a')[0];
        var price = ev.parentNode.getElementsByClassName('price')[0];
        var goodsimg = ev.parentNode.getElementsByClassName("goodsimg")[0].src;
        var id = goods.id;
        if(Number(kucun)>0&&Number(isshow) != 3){
            if(LimiteBuy(ev)) {
                if (Number(isguige) == 0) {//无规格商品
                    $.post("{php echo app_url('goods/ajaxlist/add')}",
                        {
                            id: evid,
                            guige: ''
                        },
                        function (data) {
                            if (data == 1) {
                                //根据购物车坐标获得动画路径
                                var img = ev.getElementsByTagName("img")[0];
                                var buynums = ev.parentNode.getElementsByClassName('number')[0];
                                var top = ev.getBoundingClientRect().top;
                                var bottom = innerHeight - top;
                                var left = ev.getBoundingClientRect().left;
                                var buycartimg = document.getElementById("buycartimg");
                                var buycartimgleft = buycartimg.getBoundingClientRect().left + 10;
                                var buycartimgbottom = innerHeight - buycartimg.getBoundingClientRect().top + 10;
                                img.style.setProperty("display", "block");
                                var relativeLeft = left - buycartimgleft;
                                var relativeBottom = bottom - buycartimgbottom;
                                var ratio = relativeBottom / relativeLeft;
                                var aleft = 0;
                                var abottom = 0;
                                var valueR = 4;
                                (function drawFrame() {
                                    var timeID = requestAnimationFrame(drawFrame, img);
                                    aleft -= valueR;
                                    abottom -= valueR * ratio;
                                    if (aleft < -relativeLeft) {
                                        cancelAnimationFrame(timeID);
                                        img.style.setProperty("display", "none");
                                        img.style.setProperty("left", "0px");
                                        img.style.setProperty("bottom", "0px");
                                    }else {
                                        img.style.setProperty("left", aleft + "px");
                                        img.style.setProperty("bottom", abottom + "px");
                                    }
                                }());
                                buynums.style.setProperty("display", "block");
                                updataCar(false, ev, evid);
                            } else if (data == 0) {
                                $.toast('购买失败');
                            } else if (data == -1) {
                                $.toast('库存不足');
                            } else if (data == 2) {
                                $.toast('该商品限购');
                            }
                        }
                    );
                } else if (Number(isguige) == 1) {//有规格商品
                    var str = '';
                    if (Guigein[evid] === undefined) {
                        //获取规格参数
                        $.post(
                            "{php echo app_url('goods/list/specsajax')}",
                            {id: evid},
                            function (data) {
                                var responseText = JSON.parse(data);
                                Guigein[evid] = responseText;
                                sessionStorage.setItem("guigein", JSON.stringify(Guigein));
                                for (var i = 0; i < responseText[0]['specs'].length; i++) {
                                    var itemlen = responseText[0]['specs'][i]['items'].length;
                                    str += '<div class="guigeSelect">' + responseText[0]['specs'][i]['title'] + '</div><ul>';
                                    for (var j = 0; j < itemlen; j++) {
                                        str += '<li onclick="selectGuigeOption(this)" id="' + responseText[0]['specs'][i]['items'][j]['id'] + '">' + responseText[0]['specs'][i]['items'][j]['title'] + '</li>';
                                    }
                                    str += '</ul>';
                                }
                                $('#guigeDetail').html(str);//加载参数选项
                            }
                        )
                    } else {
                        var GuigeLen = Guigein[evid][0]['specs'].length;
                        for (var i = 0; i < GuigeLen; i++) {
                            var itemlen = Guigein[evid][0]['specs'][i]['items'].length;
                            str += '<div class="guigeSelect">' + Guigein[evid][0]['specs'][i]['title'] + '</div><ul>';
                            for (var j = 0; j < itemlen; j++) {
                                str += '<li imgUrl="' + Guigein[evid][j].thumb + '" onclick="selectGuigeOption(this)" id="' + Guigein[evid][0]['specs'][i]['items'][j]['id'] + '">' + Guigein[evid][0]['specs'][i]['items'][j]['title'] + '</li>';
                            }
                            str += '</ul>';
                        }
                        $('#guigeDetail').html(str);//加载参数选项
                    }
                    $('#guigeimg').attr('src', $(ev).parent().find('.goodsimg').attr('src')).attr('data-id', evid);//加载图片
                    $('#guigeimg').next().html('0.00');
                    //弹出规格窗口
                    $('#selectGuige')[0].style.setProperty("height", "100%");
                    $('#selectGuige')[0].style.setProperty("opacity", "1");
                }
            }
        }else if (ev.getElementsByClassName("pluslist")[0].innerHTML == '上架通知'){
            if (confirm("上架通知么")){
                ev.style.backgroundColor = "#fcc602";
                ev.getElementsByClassName("pluslist")[0].innerHTML = '等待通知';
                postAjax(id, urlNotice);
                User[id] = 1;
                localStorage.setItem("user",JSON.stringify(User));
            }
        }else if (ev.getElementsByClassName("pluslist")[0].innerHTML == '等待通知') {
            if (confirm("取消上架通知么")){
                ev.style.backgroundColor = "#444";
                ev.getElementsByClassName("pluslist")[0].innerHTML = '上架通知';
                postAjax(id, urlNoticeRemove);
                delete User[id] ;
                localStorage.setItem("user",JSON.stringify(User));
            }

        }
    }
    function LimiteBuy(ev){
        var manylimit,historylimit,onelimit,surplusLimit;
        //第一次进入页面Buy为空，limit数据从界面获取
        if(Buy.length===undefined) {
            manylimit = Number($(ev).parent().find('span.many_limit').html());
            historylimit = Number($(ev).parent().find('span.history_limit').html());
            onelimit = Number($(ev).parent().find('span.one_limit').html());
            surplusLimit=eval(manylimit)-eval(historylimit);//剩余可购买数

            if(onelimit==0 && manylimit>0){     //第三种情况，onelimit为0，manylimit>0限购
                if(surplusLimit<=0){
                    $.toast("当前用户总限购数："+manylimit+"件");
                    return false;
                }
                return true;
            }
        }
        Buy=JSON.parse(sessionStorage.getItem('Buy'));
        for(var i in Buy){
            if(Buy[i].id==$(ev).parent().children('a').attr('id')){
                manylimit=Number(Buy[i].manylimit);
                historylimit=Number(Buy[i].historylimit);
                onelimit=Number(Buy[i].onelimit);

                surplusLimit=eval(manylimit)-eval(historylimit);//剩余可购买数
                if(onelimit>0 && manylimit>0){     //第一种情况，onelimit不为0，并且manylimit>0
                    if(surplusLimit<=0){
                        $.toast("当前用户总限购数："+manylimit+"件");
                        Buy[i]['num']=0;
                        $(".minus").hide(); //隐藏-号
                        return false;
                    }
                    if(Buy[i]['num']>=onelimit){
                        $.toast("当前限购："+onelimit+"件");
                        Buy[i]['num']=parseInt(onelimit);
                        return false;
                    }else if(Buy[i]['num']>=surplusLimit){
                        $.toast("最多还可购买："+surplusLimit+"件");
                        Buy[i]['num']=parseInt(surplusLimit);
                        return false;
                    }
                    Buy[i]['num']++;
                    return true;
                }

                if(onelimit>0 && manylimit==0){     //第二种情况，onelimit不为0，manylimit=0不限购
                    if(Buy[i]['num']>=onelimit){
                        $.toast("当前限购："+onelimit+"件");
                        Buy[i]['num']=parseInt(onelimit);
                        return false;
                    }
                    Buy[i]['num']++;
                    return true;
                }

                if(onelimit==0 && manylimit>0){     //第三种情况，onelimit为0，manylimit>0限购
                    if(surplusLimit<=0){
                        $.toast("当前用户总限购数："+manylimit+"件");
                        Buy[i]['num']=0;
                        return false;
                    }else if(Buy[i]['num']>=surplusLimit){
                        $.toast("剩余可购买数量最多："+surplusLimit+"件");
                        Buy[i]['num']=parseInt(surplusLimit);
                        return false;
                    }
                    Buy[i]['num']++;
                    return true;
                }

                //除去以上三种情况的情况
                Buy[i]['num']++;
                return true;
            }
        }
        return true;
    }
    //选择规格，首先判断是否全被选中，然后根据规格跳转购买界面
    $('#confirmDetail').on('click',function () {
        if ($('.guigeprice').html()!='0.00'){
            selectGuige.style.setProperty("height","0px");
            selectGuige.style.setProperty("opacity","0");
            var lisGuige=$('#guigeDetail').find('li.guigeactive');
            var guigePJ=lisGuige[0].innerHTML;
            for(var i=0;i<lisGuige.length;i++){
                if(i>0)guigePJ+=('+'+lisGuige[i].innerHTML);
            }
            $.post("{php echo app_url('goods/ajaxlist/add')}",
                {
                    id:$('#guigeimg').attr('data-id'),
                    guige:guigePJ
                },
                function(data){
                    if(data==1){
                        updataCar(true);
                    }else if(data==0){
                        $.toast('添加失败');
                    }else if(data==-1){
                        $.toast('库存不足');
                    }else if(data==2){
                        $.toast('该商品限购');
                    }
                }
            );
        }else{
            $.toast("请选择规格");
        }
    });

    //规格列表出来后点击不选放弃,x按钮
    $('#forgive').on('click',function () {
        selectGuige.style.setProperty("height","0px");
        selectGuige.style.setProperty("opacity","0");
    });
    //选满规格然后调处价格
    function selectGuigeOption(ev) {
        if($(ev).attr("imgUrl")!='')$("#guigeimg").attr('src',$(ev).attr("imgUrl")); //切换时变更图片
        //选中变色
        $(ev).parent().children('li').removeClass('guigeactive');
        $(ev).addClass('guigeactive');
        var liGuiges=$(ev).parent().parent().find('li.guigeactive');
        var guigePingJie=liGuiges[0].innerHTML;
        for(var i=0;i<liGuiges.length;i++){
            if(i>0)guigePingJie+=('+'+liGuiges[i].innerHTML);
        }
        var guigeid=$('#guigeimg').attr('data-id');
        for(var j=0;j<Guigein[guigeid].length;j++){
            if(Guigein[guigeid][j].title==guigePingJie)$('#guigeimg').next().html(Guigein[guigeid][j].productprice);
        }
    }


    function updataCarHtml(){
        Buy=JSON.parse(sessionStorage.getItem('Buy'));
        GuigeSelect=JSON.parse(sessionStorage.getItem('GuigeSelect'));
        var str="";
        for (var key in Buy) {
            if (GuigeSelect[key] ===undefined) {//没有规格商品
                if (Buy[key]['num'] !=undefined){
                    str+='<div class="tablerow"><div class="buyimg"><span class="cartDetailGuige"></span><img src='+Buy[key]['img']+'></div><div class="buyprice">￥'+Buy[key]['price']+'</div><div class="buydes"><div class="buyplus" onclick="minuscarNumber(this)"><img src="http://wx866e0a731d303c29.w9.huodiesoft.com/addons/lexiangpingou/app/resource/images/minus.png" style="width:14px;heigth:14px;"></div><span class="key">'+key+'</span><div class="buynum" data-id='+Buy[key].id+'>'+Buy[key]['num']+'</div><div class="buyminus" onclick="pluscarNumber(this)"><img src="http://wx866e0a731d303c29.w9.huodiesoft.com/addons/lexiangpingou/app/resource/images/plus.png" style="width:14px;heigth:14px;"></div></div></div>';
                }
            }else{//有规格商品
                var numArray =[];
                var guigeArray = [];
                for (var li in GuigeSelect[key]) {
                    numArray.push(GuigeSelect[key][li]);//值
                    guigeArray.push(li);//属性
                }
                str+='<div class="tablerow"><div class="buyimg"><img src='+Buy[key]['img']+'></div>';
                for(var i=0;i<numArray.length;i+=4){
                    str+='<div class="tablerow"><div class="buyimg"><span class="cartDetailGuige" style="font-size:0.8em;color:hsl(354, 90%, 73%)">'+guigeArray[i]+'</span></div><div class="buyprice">￥'+numArray[i+1]+'</div><div class="buydes"><div class="buyplus" onclick="minuscarNumber(this)"><img src="http://wx866e0a731d303c29.w9.huodiesoft.com/addons/lexiangpingou/app/resource/images/minus.png" style="width:14px;heigth:14px;"></div><span class="key">'+key+'</span><div class="buynum" data-id='+Buy[key].id+'>'+numArray[i]+'</div><div class="buyminus" onclick="pluscarNumber(this)"><img src="http://wx866e0a731d303c29.w9.huodiesoft.com/addons/lexiangpingou/app/resource/images/plus.png" style="width:14px;heigth:14px;"></div></div></div>';
                }
                str+='</div>';
            }
        }
        $('#buycartDetails').html(str);
    }

    //回到顶部
    $('#gotop').on('click',function () {
        document.getElementById("banner").scrollIntoView();
    });

    function updataCar(RorF,ev,evid){
        $.post("{php echo app_url('goods/ajaxlist/collect')}",function(data){
            data=JSON.parse(data);
            var BuyObj={};
            var GuigeSelectObj={};
            var carSum=0;//购物车总数量
            var carPriceSum=0;//购物车总价格
            //规格 颜色，价格，库存，重量
            var color;
            var colorPrice;
            var colorStock;
            var colorWeight;
            if(data.length>0){
                for(var j=0;j<data.length;j++) {
                    var Buy={},GuigeSelect={};
                    var keyNum,num=0;
                    carSum+=Number(data[j].num);
                    carPriceSum+=Number(data[j].num)*Number(data[j].price);
                    for(var key in BuyObj){//遍历数据判断有无相同id的数据
                        if (key===undefined) return;
                        if(BuyObj[key].id==data[j].id){
                            keyNum=key;
                            num++;
                        }
                    }
                    if(num>0){//判断有无相同id，有则合并数据，并且Buy中只修改num数据
                        color = data[j].item;
                        colorPrice = color + 'Price';
                        colorStock = color + 'Stock';
                        colorWeight = color + 'Weight';
                        GuigeSelectObj[keyNum][color] = data[j].num;
                        GuigeSelectObj[keyNum][colorPrice] = data[j].oprice;
                        GuigeSelectObj[keyNum][colorStock] = data[j].kucun;
                        GuigeSelectObj[keyNum][colorWeight] = data[j].weight;

                        BuyObj[keyNum].num = parseInt(BuyObj[keyNum].num)+1;

                    }else {
                        Buy.img = data[j].img;
                        Buy.price = data[j].price;
                        Buy.title = data[j].title;
                        Buy.weight = data[j].weight;
                        Buy.kucun = data[j].kucun;
                        Buy.id = data[j].id;
                        Buy.num = data[j].num;
                        Buy.onelimit = data[j].onelimit;
                        Buy.manylimit = data[j].manylimit;
                        Buy.historylimit = data[j].historylimit;
                        BuyObj[j] = Buy;

                        if (data[j].item != '') {
                            color = data[j].item;
                            colorPrice = color + 'Price';
                            colorStock = color + 'Stock';
                            colorWeight = color + 'Weight';
                            GuigeSelect[color] = data[j].num;
                            GuigeSelect[colorPrice] = data[j].oprice;
                            GuigeSelect[colorStock] = data[j].kucun;
                            GuigeSelect[colorWeight] = data[j].weight;

                            GuigeSelectObj[j] = GuigeSelect;
                        }
                    }
                }
                console.log('数据库数据：');
                console.log(data);
                sessionStorage.setItem('Buy', JSON.stringify(BuyObj));
                sessionStorage.setItem('GuigeSelect', JSON.stringify(GuigeSelectObj));
                sessionStorage.setItem('carObjSJK', JSON.stringify(data));
                updataCarHtml();
                $('#totalnum').css('display','block');
                $('#totalnum').html(carSum);//更新购物车总数量
                $('#sumprice').html('去结算 ￥'+carPriceSum.toFixed(2));//更新购物车总价格

                var ObjSJK = JSON.parse(sessionStorage.getItem('carObjSJK'));
                //界面加，购买数量及价格变化
                if(RorF){//有规格商品
                    var glis = $('#orderlist li.gli>a');
                    for (var ij = 0; ij < glis.length; ij++) {
                        if ($(glis[ij]).attr('id') == $('#guigeimg').attr('data-id')) {
                            ev = $(glis[ij]).next().next()[0];
                        }
                    }
                    var bPrice = $(ev).parent().find('b.price');
                    var sumPrice = 0, sumNum = 0;
                    $(ev).parent().find('.cross').css('display', 'inline-block');//显示 x
                    for (var i = 0; i < ObjSJK.length; i++) {
                        if (ObjSJK[i].id == $('#guigeimg').attr('data-id')) {
                            sumNum += Number(ObjSJK[i].num);
                            sumPrice += Number(ObjSJK[i].num) * Number(ObjSJK[i].oprice);
                        }
                    }
                    bPrice.html(sumNum).next().children().css('display', 'none');
                    $(ev).parent().find('.totalPrice').html('小计￥' + sumPrice.toFixed(2)).css('display', 'inline-block');
                    $(ev).children('span').css('font-size','30px').html('<img src="{TG_URL_ARES}images/plus.png" style="width:20px;heigth:20px;">').css('line-height', '15px');//买变加号,不显示减号
                }else if(!RorF&&RorF!=undefined){//无规格商品
                    var bPrice=$(ev).parent().find('b.price');
                    for(var i=0;i<ObjSJK.length;i++) {
                        if (ObjSJK[i].id==evid) {
                            $(ev).parent().find('.cross').css('display', 'inline-block');//显示 x
                            bPrice.html(ObjSJK[i].num).next().children().css('display','none');
                            var sumPrice = Number(bPrice.html()) * Number(ObjSJK[i].oprice);
                            $(ev).parent().find('.totalPrice').html('小计￥' + sumPrice.toFixed(2)).css('display','inline-block');
                            $(ev).children('span').css('font-size','30px').html('<img src="{TG_URL_ARES}images/plus.png" style="width:20px;heigth:20px;">').css('line-height', '15px').parent().siblings('.minus').css('display', 'inline-block');//买变加号,并显示减号
                            return false;
                        }
                    }
                }
            }else if(data.length==0){
                sessionStorage.setItem('Buy','{}');
                sessionStorage.setItem('GuigeSelect','{}');
                sessionStorage.setItem('carObjSJK','{}');
                $('#buycartDetails').empty();
                $('#totalnum').css('display','none');
                $('#sumprice').html('￥ 0');
            }
        })
    }
    $("#gohome").on('click',function() {
        sessionStorage.removeItem("position");
    });

    //删除购物车的条目，先ajax通知后台，后台清除成功后再清除前端数据
    function clearBuycart(){
        var minuses = document.getElementsByClassName('minus');
        var xhr = new XMLHttpRequest();
        xhr.open('post', urlclear, true);
        xhr.send(null);
        xhr.onreadystatechange = function() {
            if (xhr.readyState ==4) {
                if ((xhr.status >=200 && xhr.status<300) || xhr.status ==304){
                    if (Number(xhr.responseText)>0){
                        $('#buycartDetails').html('');
                        for (var key in Buy){
                            if (minuses.length > Number(key)){
                                resetPrice(Number(key),Buy[key]['price']);
                            }
                            delete Buy[key];
                        }
                        for (var a in GuigeSelect) {
                            delete GuigeSelect[a];
                        }
                        totalNum();
                    }else{
                        //$.toast("清除失败");
                    }
                }else {
                    console.log("错误");
                }
            }
        }
    }
    //重置清除关于小计的价格说明指示
    function resetPrice(index, price) {
        var cross = document.getElementsByClassName("cross")[index];
        cross.style.display = 'none';
        var priceu = document.getElementsByClassName('price')[index];
        priceu.innerHTML ='￥' + Number(price).toFixed(2);
        var totalPrice = document.getElementsByClassName('totalPrice')[index];
        totalPrice.style.display = 'none';
    }
    function addItems(thispage, thispagesize) {
        var thispagesizemax=100;
        var ajaxurl = "{php echo app_url('goods/list/ajax',array('cid' => $cid))}" + "&page=" + thispage + "&pagesize=" + thispagesize;
        $.ajax({
            type: "POST",
            url: ajaxurl,
            dataType: 'json',
            beforeSend: function(XMLHttpRequest) {},
            success: function(data) {
                thispagesizemax = data.total;
                if (data.list.length > 0) {
                    var gettpl = document.getElementById('goodslist').innerHTML;
                    laytpl(gettpl).render(data, function(html){
                        $(".ul_1").append(html);
                    });
                } else {
                    $(".loading_more").remove();
                    $('.noData').show();
                }
                joinSession();
                setSealout();
            },
            error: function() {
                $('.error').show();
            }
        });
    }
    $('div.error').on('click',function(){
        addItems(sessionStorage.getItem('thispage'),4);
    });

    if(!getQueryString('gid')){
        $('.fenleiFST li:first-child').addClass('active');
    }else {
        $('li[data-idFst="' + getQueryString('gid') + '"]').addClass('active');
    }
    //点击一级分类跳转
    $('.fenleiFST').on('click','li',function(){
        if($(this).hasClass('active')){return false;}
        location.href=$(this).attr('data-href');
    });


    //加载二级分类
    $.get(
        "{php echo app_url('goods/list/fenleiTwo')}",
        {id:getQueryString('gid')},
        function(res){
            var data=JSON.parse(res);
            var html='',htmlAll='';
            var len=data.length>7?7:data.length;
            for(var i=0;i<len;i++){//加载前七项
                var url=data[i].url||"";
                html+='<a href="javascript:;" onclick="ejHtml('+data[i].id+',1,6,this)" class="external" data-url='+url+'>' +
                    '<img src='+data[i].thumb+' alt=""><span>'+data[i].name+'</span></a>';
            }
            for(var i=0;i<data.length;i++){//加载全部
                var url=data[i].url||"";
                htmlAll+='<a href="javascript:;" onclick="ejHtml('+data[i].id+',1,6,this)" class="external" data-url='+url+'>' +
                    '<img src='+data[i].thumb+' alt=""><span>'+data[i].name+'</span></a>';
            }
            if(data.length>7) {
                html += '<a href="javascript:;" class="external" onclick='+'$(".allFL").slideDown()'+'>' +
                    '<i class="iconal-dian" style="width: 40px; height: 40px;background: #ddd;display: block;text-align: center;line-height: 40px;color: #fff;font-size: 1.5em;border-radius: 50%;margin: 0 auto 12px;"></i><span>查看全部</span></a>';
            }
            $('.j-rmd-types').html(html);
            $('.allFL .j-rmd-types').html(htmlAll);
        });

    //加载二级分类商品
    function ejHtml(id,page,pagesize,e,append){
        thispage=page;
        page=page;
        if(page==1){
            loading = false;
        }
        if($(e).attr('data-url')){location.href=$(e).attr('data-url')};
        $('.noData').css('display','none');
        sessionStorage.setItem('ejID',id);
        console.log($(e).parent().parent());
        if($(e).parent().parent().hasClass('allFL')){
            $('.allFL').slideUp();
        }
        $.get(
            "{php echo app_url('goods/list/ejHtml')}",
            {
                id:id,
                ishunda:'1',
                page:page,
                pagesize:pagesize
            },
            function(res){
//                console.log(res);
                var data=JSON.parse(res).list;
                var html='';
                for(var i=0;i<data.length;i++){
                    var noneimg=(data[i].gnum!=0)?'none':'block';
                    var isT='';
                    var price=0;
                    if(data[i].selltype==0){
                        isT='<b style="font-weight: 400" class="iconal-gouwuche"></b>';
                        price=data[i].oprice;
                    }else{
                        isT='已团 '+data[i].salenum+data[i].unit;
                        price=data[i].gprice;
                    }
                    html+='<li class="gli" style="position:relative;"><a href='+data[i].a+' class="external externals" id='+data[i].id+' onclick="sesso(this)">' +
                        '<img class="noneimg" src="{TG_URL_ARES}images/noneRed.png" style="display: '+noneimg+'; position: absolute; width: 100px; z-index: 2; left: calc(50% - 50px); top: 50px;">' +
                        '<div class="img"><img src='+data[i].share_image+' alt="" style="opacity: 1;"><div class="icon_position"><div class="discount"><span>0折<br>2人团</span></div></div></div>' +
                        '<div class="txt"><h5>'+data[i].gname+'</h5><p style="display: none"></p></div><div class="fnWrap"><div class="fnZone"><i style="display: none"></i>' +
                        '<span><b class="people" style="display: none;">'+data[i].groupnum+'人团</b><b class="price">￥'+price+'</b></span>' +
                        '<span style="font-size: 12px;color: #aaa;float: right;">'+isT+'</span>' +
                        '<span class="btn" style="display: none; position: relative; width: 100px; height: 35px; line-height: 35px; background-color: rgb(228, 57, 60); color: rgb(255, 255, 255); border-radius: 4px; text-align: center; font-size: 20px;">' +
                        '<span class="isshow" style="display:none;">'+data[i].isshow+'</span><span class="isupjia" style="display:none;">'+data[i].isupjia+'</span><span class="typenotice">售罄</span>' +
                        '<span style="position: absolute;top:-1px;margin-left: 5px">&gt;</span></span></div></div>' +
                        '<div class="kucun" style="display:none;">'+data[i].gnum+'</div></a><span class="noticeup" onclick="notice(this)" style="position:absolute;background-color:rgba(0,0,0,0);left:200px;bottom:10px;width:100px;height:40px;display:none;"></span></li>   ';
                }
                if(append=='append'){
                    if(html==""){
                        $('.noData').css('display','block');
                        $('.loading_more').remove();
                        loading = true;
                        return false;
                    }
                    $('.listCon>ul').append(html);
                }else {
                    if(html==""){
                        $('.noData').css('display','block');
                        $('.loading_more').remove();
						$('#orderlist ul').html('');
                        loading = true;
                        return false;
                    }
                    $('.listCon>ul').html(html);
                }
            });
        $('.j-rmd-types.rmd-types span').css('color','#2f2f2f');
        $('a[onclick="ejHtml('+sessionStorage.getItem('ejID')+',1,6,this)"]').find('span').css('color','#ed5111');
    }
    setTimeout(function() {
        $('a[onclick="ejHtml(' + (sessionStorage.getItem('ejID') || getQueryString('ejid')) + ',1,6,this)"]').find('span').css('color', '#ed5111');
    },300);


    //滚动条选中元素居中
    var item = $(".fenleiFST>ul li.active");
    var container = $(".fenleiFST>ul");
    var itemOffset = item.offset();
    var itemOffsetLeft = itemOffset.left + container.scrollLeft();
    var centerLeft = (container.width()- item.width()) / 2;
    container.scrollLeft(itemOffsetLeft - centerLeft);

    $('#submit').click(function(){
        var value=$('#keywordBox').val();
        if(value==""){
            return false;
        }
        location.href="{php echo app_url('goods/list/fenlei_detail', array('gid' => $_GPC['gid']))}"+"&keyword="+value;
    });
</script>
<style>
    .fnZone i{
        width: 25px;
        margin-top: 5px;
        margin-left: -10px;
        background: url(../../../../../../addons/lexiangpingou/app/resource/images/list/groupnew6.png) no-repeat;
        background-size: 25px;
    }
    .fnZone{
        width: 95%;
    }
    .fnZone .people{
        color:#666;
    }
    .listCon .img .icon_position{
        display: none;
    }
</style>
<!--{php include wl_template('common/footer');}-->
	 