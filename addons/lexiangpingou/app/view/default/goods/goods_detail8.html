{php include wl_template('common/header');}
{if $config['base']['meiqia']>0}
<script type='text/javascript'>
    console.log({$goods['spikeT']});


    (function(m, ei, q, i, a, j, s) {
        m[a] = m[a] || function() {
            (m[a].a = m[a].a || []).push(arguments)
        };
        j = ei.createElement(q),
            s = ei.getElementsByTagName(q)[0];
        j.async = true;
        j.charset = 'UTF-8';
        j.src = i + '?v=' + new Date().getUTCDate();
        s.parentNode.insertBefore(j, s);
    })(window, document, 'script', '//static.meiqia.com/dist/meiqia.js', '_MEIQIA');
    _MEIQIA('entId', {$config['base']['meiqia']});
</script>
{/if}
<style>
    .stepGuild .step_tit i,.stepGuild .step_item_on .step_num{
    background-color: {$_W['system_color']};
    }
    .link-rule{
        height:100%;
        width:100%;
        background-color:
                rgba(128,128,128,0.5);
        position:fixed;top:0px;
        left:0px;
        z-index:10000;
    }
    .link-rule>div{
        text-align:center;
        position:absolute;
        top:0;
        bottom:0;
        left:8px;
        right:8px;
        margin-top:auto;
        margin-bottom:auto;
        height:85%;
        background-color:white;
        border-radius:8px;
    }
    .link-rule>div>div:first-child{
        font-weight:bold;
        background-color:#ececec;
        font-size:20px;
        line-height:40px;
        border-radius:8px 8px 0 0;
        height:40px;
    }
    .link-rule>div div:nth-child(2){
        text-align:left;
        position:absolute;
        top:48px;
        bottom:45px;
        left:19px;
        right:19px;
        overflow:scroll;
    }
    .link-rule>div div:last-child{
        position:absolute;
        left:0px;
        right:0px;
        width:150px;
        height:30px;
        bottom:5px;
    background-color:{$_W['system_color']};
    color:white;
    font-size:18px;
    margin-left:auto;
    margin-right:auto;
    line-height:30px;
    border-radius:5px;
    }
    #pricedown {
        display: block;
        width: 40px;
        height: 40px;
        background-color: hsl(194, 57%, 64%);
        color: hsl(0, 0%, 100%);
        line-height: 15px;
        text-align: center;
        border-radius: 20px;
        padding-top: 5px;
        font-size: 12px;
        right: 20px;
        bottom: -20px;
        position: absolute;
    }
    #numPerson,#numPrices,#numGroup, #tuanPre {display:none;}
    #jieTiGroup {background-color:white;padding:10px;}
    #jieTiGroup>div {margin-bottom:10px;}
    #jieTiGroup>div>div:first-child{width:100%;height:20px;}
    .preTuan{height:20px;width:50%;line-height:20px;box-sizing:border-box;float:left;}
    .numTuan {height:20px;width:100%;line-height:20px;box-sizing:border-box;text-align:right;}
    .process{margin-top:20px;margin-bottom:20px;position:relative;width:90%;margin-left:5%;height:20px;border-radius:10px;background-color:white;border:1px solid hsl(354, 91%, 73%)}
    .progressBar {background-image:linear-gradient(90deg,{$_W['system_color']},hsl(354, 91%, 73%));height:100%;border-radius:10px;left:0px;top:0px;}
    .progressStep {border:1px solid white;height:14px;width:4px;border-radius:7px;position:absolute;top:2px;background-color:white;}
    .progressStep>div:first-child {position: absolute;top: -20px;width: 40px;text-align: center;left: -20px;line-height: 20px;height: 20px;}
    .progressStep>div:last-child {position: absolute;top: 14px;width: 40px;text-align: center;left: -20px;line-height: 20px;height: 20px;}
    .payToGroup {height: 30px;line-height: 30px;text-align: center;width: 80%;background-color: rgb(248, 123, 136);border-radius: 20px;color: white;margin-left: 10%;}
    #over {text-align:right}
    .link-rule p {text-indent:2em;}
    #returnBack {
        width: 40px;
        height: 40px;
        border-radius: 20px;
        background: linear-gradient(90deg,transparent 1px, hsla(0, 0%, 50%, 0.7) 0);
        position: absolute;
        left: 20px;
        top: 20px;
        z-index: 3;
        color: white;
        text-align: center;
        line-height: 16px;
        padding-top: 4px;
        font-weight: bold;
        font-size: 12px;
    }
    #returnBack::before {
        content: '';
        position: absolute;
        left: -3px;
        top: 16px;
        height: 8px;
        width: 8px;
        background: linear-gradient(45deg,hsla(0, 0%, 50%,0.7) 50%, transparent 0);
        transform: rotate(45deg);
        -webkit-transform:rotate(45deg);
    }
    .zhuiping{
        font-size: 12px;
        background: #aaa;
        padding: 3px 6px;
        border-radius: 4px;
        color: #fff;
    }
    .aboutProduct{
        width: 100%;
        padding-bottom: 1rem;
        display: flex!important;
        flex-wrap: wrap;
        justify-content: center;
    }
    .aboutProduct li{
        width:90px!important;
    }
    .aboutProduct li img{
        height:90px!important;
    }
    .aboutProduct li:first-child{
        margin-left: 3.4%!important;
    }
    .section_detail img{
        width: 100%!important;
        height: auto!important;
    }
    .remainingT{
        position: relative;
        color: #fff;
        display: flex;
        display: -webkit-flex;
        padding:5px 10px;
        justify-content: space-between;
        background: {$_W['system_color']};
    }
    .T_time{
        font-size: 12px;
    }
    .T_price{
        flex: 1;
        -webkit-flex: 1;
        flex-direction: row;
        align-items: center;
    }
    .T_time span{
        padding: 2px;
        background: #f0f1eb;
        border-radius: 5px;
        margin: 0 2px;
        color: {$_W['system_color']};
    }
    .T_warpper {
        display: flex;
        flex-direction: row;
        align-items: center;
    }
    .T_groupnum{
        position: relative;
        top: 4px;
        left: 0;
        font-size: 12px;
        background: {$_W['system_color']};
        padding: 0 5px;
        border-top-right-radius: 5px;
    }
</style>
<span id="tuanPre">666,777</span>
<span id="numPerson">10,20,50,100</span>
<span id="numPrices">0.03,0.02,0.01,0.005</span>
<span id="numGroup">100,40</span>
<span id="goodsid">{$goods['id']}</span>
<span id="isshow">{$goods['isshow']}</span>
<div class="page-group">
    <div class="page page-current" id="page-goods-detail">
        <div id="returnBack">
            返回<br/>商城
        </div>
        <div class="content">
            <div class="dt_detail" >
                <section class="detail_main" style="position:relative">
                   
                    <div class="sliderImage">
                        <div class="images" id="sliderImg" style="visibility: visible;">
                            <ul>
                                {php include wl_template('common/video_detail');}
                                {loop $advs $adv}
                                <li><img src="{php echo tomedia($adv['thumb']);}" style='width:100%;'></li>
                                {/loop}
                            </ul>
                        </div>
                        <div class="images_num" id="sliderNum">
                            {php $slideNum = 1;}
                            {loop $advs $adv}
                            <span{if $slideNum == 1} class="curr"{/if}></span>
                            {php $slideNum++;}
                            {/loop}
                        </div>
                    </div>
                   
                    <div class="remainingT">
                        <div class="T_warpper">
                            <div class="T_groupnum">{$goods['groupnum']}人团</div>
                            <div class="T_price">

                            ￥<span style="font-size: 24px">{$goods['gprice']}</span>
                            <s>￥{$goods['mprice']}</s>
                        </div>
                        </div>  
                        
                        <div class="T_time">
                            {if $goods['spikeT']==1}<p>距下架仅剩</p>{/if}
                            <div>

                            </div>
                        </div>
                    </div>
                    <div class="productInfo" >
                        <h2 style="padding-top: 10px;">{$goods['gname']}</h2>
                        <span id="pricedown"  {if $goods['isdownjia']==0}style="display:none;"{/if}>降价<br/>通知</span>
                        <div class="editor"></div>
                    </div>
                    <div id="jieTiGroup">

                    </div>
                    <div class="salesVolume" style="display: block"><span style="float: left">库存{$goods['gnum']}</span> 已拼{$goods['salenum']}件·{$goods['groupnum']}人拼单</div>
                    <!--<div style="padding-left:10px;color:#888;background-color:white;font-size:0.8em;">商品确认收货后可获得10086积分</div>-->
                    <div class="progressOuter noShow"><span class="suc_tuan">已成团</span>
                        <div class="progress"><div class="percent"></div></div><span class="total_tuan">共团</span></div>
                    <div class="playTips" style="margin-top:-8px;">支付开团并邀请好友参加，人数不足自动退款，详见下方团购玩法</div>
                    <script>
                        var swipeConfig = {
                            speed:500,
                            auto:3000,
                            callback: function(){
                                var lis = $("#sliderNum").children();
                                lis.removeClass("curr").eq(this.index).addClass("curr");
                            }
                        }
                        var swipe;
                        (function() {
                            swipe = new Swipe($('#sliderImg')[0], swipeConfig);
                            $('video').attr('poster',"{$goods['gimg']}").attr('id','media').attr('controls','controls');
                            var mmedia = document.getElementById("media");
                            mmedia.onplay=function(){
                                console.log("视频已播放.");
                                swipe.stop()
                                $.get("{php echo app_url('goods/detail/up_num')}",{id:$('video').attr('data-id')},function(res){
                                    console.log(res);
                                    if(JSON.parse(res).status=='error'){
                                        $('video').removeAttr('src');
                                        $.toast("已无播放次数");
                                    }
                                })
                            };
                            mmedia.onpause=function() {
                                swipe.begin()
                            }
                        })()
                    </script>
                    <!--//佣金外快-->
                    {php include wl_template('common/commission');}

                </section>
                <!--签收有礼-->
                {php include wl_template('common/sendcoupon');}


                <div class="space" style="display: none;"></div>
                <!--//进店逛逛 多商户-->
                {php include wl_template('common/shopdiv');}

                <!--分享团-->
                {if !empty($thistuan)}
                {if ($share_data['share_type']==1 || $share_data['share_type']=='')}
                <div id="more_tuan" style="margin-top: 10px;{if $goods['ison']==0}display:none;{/if}">
                    <div class="ht">
                        <div class="ht_tit">附近的小伙伴正在发起团购，您可以直接参与</div>
                        <div class="ht_list">
                            {loop array_slice($thistuan,0,2) $tuan}
                            <div class="ht_item">
                                <div class="ht_avatar"><img src="{$tuan['avatar']}" alt="团长头像"></div>
                                <div class="ht_info"><div class="ht_name">{$tuan['nickname']}</div><div class="ht_time" data_endTime="{$tuan['endtime']}"><div></div></div></div>
                                <a href="{php echo app_url('order/group',array('tuan_id'=>$tuan['groupnumber']));}" class="ht_btn" ptag="20400.7.1"><span class="ht_price"><i>￥</i>{$goods['gprice']} / {$goods['unit']}</span><span class="ht_btn_go">差{$tuan['lacknum']}人成团，点击参团 》</span></a>
                            </div>
                            {/loop}
                        </div>
                    </div>
                </div>
                {else}
                <div id="more_tuan" style="margin-bottom: 60px;">
                    <div class="ht">
                        <div style="text-align: center;">
                            <a href="{php echo $this->createMobileUrl('goodsdetails',array('share_type'=>'share_type','id'=>$id));}" style="background-color: #FF5252;border-radius: 3px;width: 90%;height: 50px;text-align: center;color: rgb(255, 255, 255);margin-left: 5%;margin-top:5px;float: left;-webkit-border-radius: 3px;">
                                <b><font size="5"><div class="ico2" style="margin-top: 10px;;"><i class="fa fa-map-marker"></i> 附近的团</div></font></b>
                            </a>
                        </div>
                    </div>
                </div>
                {/if}
                {/if}
                {if $setting['group_rule_switch'] != 2}
                <section class="stepGuild">
                    <div class="step_tit"><i></i>拼团玩法<span><span id="lookdetail">查看详情&gt;</span></span></div>
                    <div class="step_flow">
                        <div class="step_item step_item_on"><span class="step_num" >1</span><span>选择<br>心仪商品</span></div>
                        <div class="step_item"><span class="step_num">2</span><span class="steps">支付开团<br>或参团</span></div>
                        <div class="step_item"><span class="step_num">3</span><span class="steps">邀请好友<br>参团支付</span></div>
                        <div class="step_item"><span class="step_num">4</span><span class="steps">达到人数<br>团购成功</span></div>
                    </div>
                </section>
                {/if}
            </div>

            <div class="section_body info_detail" style="border:none;{if $goods['isjudgment']==0}display:none;{/if}">
                <div class="orderregion" style="border-bottom: none; margin-bottom: 10px;">
                    <h1 class="orderregion-title">
                        <i class="icon1-detail status-detail-icon"></i>
                        <label class="status-name">买家评价</label>
                        <a href="{php echo app_url('goods/judgment_list',array('op' => 'judgment_list','gid' => $id))}"><span style="float: right; color: #9d9d9d; font-size: 14px; height: 40px;line-height: 40px;  display: inline-block; ">共{$total}条记录&gt;</span></a>
                    </h1>

                    {loop $list $item}

                    <div style="clear: both; padding:10px; padding-bottom:0px; text-align: justify; border-bottom: 1px solid #f0f0f0;">
                        <div style="width: 12%; float: left;">
                            <img style="max-height: 100%; max-width: 100%;border-radius: 50%" src="{$item['avatar']}" >
                        </div>
                        <div style="width: 80%; float:left;margin-left: 10px; ">
                            <span style="color: #666;">{$item['openname']}</span><br>
                            <span style="color: #666; font-size: 12px; ">{$item['time']}</span>
                        </div>
                        <div style="clear: both;"></div>
                        <?php
							$main_content = pdo_fetch("select * from ".tablename('tg_judgment_content')." where  judgment_id=:judgment_id order by update_time asc ",array('judgment_id'=>$item['judgment_id']));
                        $allcontent = pdo_fetchall("select * from ".tablename('tg_judgment_content')." where  judgment_id=:judgment_id and content_id <> '". $main_content['content_id'] ."'  order by update_time asc ",array('judgment_id'=>$item['judgment_id']));
                        ?>
                        <div style="font-size: 0.9em; padding-top: 3px; padding-bottom: 3px; color: #1a1a1a;">{$main_content['content']}</div>
                        {loop $allcontent $content}
                        {if $content['who']== 1}<label class="zhuiping">商家回复</label>{/if}
                        {if $content['who']== 0}<label class="zhuiping">用户追评</label>{/if}<span style="margin-left:10px; color: #b8c0cc; font-size: 12px;"><?php echo date('Y-m-d H:i:s',$content['update_time']); ?></span>
                        <div style="font-size: 12px; font-weight: 400;padding-bottom: 3px;">{$content['content']}</div>

                        {/loop}

                    </div>
                    {/loop}

                </div>
            </div>

            <div class="section_body info_detail" {if $goods['issharedesc']==1}style="display:none;"{/if}>
            <div>
                <div id="div_nav_fixed">
                    <div id="div_nav" class="div_nav">
                        <ul class="boxx" style="padding-left: 0px;">
                            <li>
                                <a onclick="exchange(1);" data-idx="1" class="sp on" id="shangpin1">图文详情</a>
                            </li>
                            <li>
                                <a onclick="exchange(0);" data-idx="0" class="sp" id="shangpin0">商品属性</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div id="div_sections" class="div_sections">
                    <section class="section_specification">
                        {loop $params $p}
                        <dl>
                            <div>
                                <dd><label>{$p['title']}</label><label>{$p['value']}</label></dd>
                            </div>
                        </dl>
                        {/loop}
                    </section>
                    <section class="section_detail on" data-role="widget" data-widget="img_prev_view">
                        <div id="description" class="J_DetailSection tshop-psm tshop-psm-bdetaildes" style="margin:0px;padding:0px;">
                            <div class="ke-post" id="productInfott" style="margin:10px 0px 0px;padding:0px;font-size:14px;font-family:tahoma, arial, 宋体, sans-serif;">

                            </div>
                        </div>
                    </section>
                </div>
            </div>


        </div>
        <h2 class="guesslike">商品推荐 ❤</h2>
        <ul class="aboutProduct"></ul><!--aboutProduct-->
        <script type="text/javascript">guesslike("{php echo app_url('goods/ajaxlist/goods_rand')}");</script>

        <div style="height:65px;"></div>
        <input type="hidden" name="times" id="times" value="{$times}" />
        <input type="hidden" name="one_limit" id="one_limit" value="{$goods['one_limit']}" />
        <input type="hidden" name="many_limit" id="many_limit" value="{$goods['many_limit']}" />
    </div>
    {if $goods['hasoption']==1||$goods['one_limit']>1}
    {php include wl_template('goods/goods_option');}
    {/if}
    <footer class="footer" style="z-index: 1!important;height: 50px;">
        <nav>
            <ul>
                <!--spike_type  0:未开始  1：马上抢  2:已结束   3:已抢光-->

                <li style="width: 12%;"><a href="{php echo app_url('goods/list')}" id="gohome" class="nav-controller external"><img src="{TG_URL_ARES}images/icon_home.png" height="18px" width="19px"><br>首页</a></li>
                <li style="width: 12%;"><a href="{if $url_kefu!=''}{$url_kefu}{else}javascript:;{/if}"  class="nav-controller external"><i style="{if $url_kefu!=''}color:#e02e24;{/if}" class="iconal-wodefankui"></i>客服</a></li>
                {if $goods['isshow']==1&&$goods['gnum']!=0}
                {if $goods['group_level_status']==2}

                {if $goods['spikeT']==0}
                <li class="group" style="color:white;width: 38%;background: #e02e24"><a onclick='choose()' class="nav-controller"><i >￥{$goods['gprice']}</i>{$goods['groupnum']}人拼团</a>{if $goods['hasoption']==1}<span class="qkt">去开团</span>{/if}</li>
                <li class="alone" style="color:white;width: 38%;background: #f3aba7"><a  style="color:white;" href="{php echo app_url('order/orderconfirm',array('groupnum'=>1,'id'=>$goods['id']));}" class="nav-controller external"><i >￥{$goods['oprice']}</i>单独购买</a></li>
                {else}
                {if $goods['spike_type']==0}
                <li class="group" style="color:white;background: #999;width: 38%"><a href="javascript:;" class="nav-controller"><i >￥{$goods['gprice']}</i>{$goods['groupnum']}人拼团</a><span class="qkt">未开始</span></li>
                {elseif $goods['spike_type']==1}
                <li class="group" style="color:white;;background: #e02e24"><a onclick='choose()' class="nav-controller"><i >￥{$goods['gprice']}</i>{$goods['groupnum']}人拼团</a><span class="qkt">去开团</span></li>
                {elseif $goods['spike_type']==2}
                <li class="group" style="color:white;background: #999;width: 38%"><a href="javascript:;" class="nav-controller"><i >￥{$goods['gprice']}</i>{$goods['groupnum']}人拼团</a><span class="qkt">已结束</span></li>
                {elseif $goods['spike_type']==3}
                <li class="group" style="color:white;background: #999;width: 38%"><a href="javascript:;" class="nav-controller"><i >￥{$goods['gprice']}</i>{$goods['groupnum']}人拼团</a><span class="qkt">已抢光</span></li>
                {/if}
                <li class="alone" style="color:white;width: 38%;background: #f3aba7"><a  style="color:white;" href="{php echo app_url('order/orderconfirm',array('groupnum'=>1,'id'=>$goods['id']));}" class="nav-controller external"><i >￥{$goods['oprice']}</i>单独购买</a></li>
                {/if}

                {elseif $goods['hasoption']==1||$goods['one_limit']>1}
                {if $goods['spikeT']==0}
                <li class="group" style="color:white;width: 38%;background: #e02e24"><a onclick='choose(2)' class="nav-controller"><i >￥{$goods['gprice']}</i>{$goods['groupnum']}人拼团</a>{if $goods['hasoption']==1}<span class="qkt">去开团</span>{/if}</li>
                <li class="alone" style="width: 38%;background: #f3aba7"><a  style="color:white;;background: #f3aba7" onclick='choose(1)' class="nav-controller"><i >￥{$goods['oprice']}</i>单独购买</a></li>
                {else}
                {if $goods['spike_type']==0}
                <li class="group" style="color:white;background: #999;width: 38%"><a href="javascript:;" class="nav-controller"><i >￥{$goods['gprice']}</i>{$goods['groupnum']}人拼团</a><span class="qkt">未开始</span></li>
                {elseif $goods['spike_type']==1}
                <li class="group" style="color:white;width: 38%;background: #e02e24"><a onclick='choose(2)' class="nav-controller"><i >￥{$goods['gprice']}</i>{$goods['groupnum']}人拼团</a><span class="qkt">去开团</span></li>
                {elseif $goods['spike_type']==2}
                <li class="group" style="color:white;background: #999;width: 38%"><a href="javascript:;" class="nav-controller"><i >￥{$goods['gprice']}</i>{$goods['groupnum']}人拼团</a><span class="qkt">已结束</span></li>
                {elseif $goods['spike_type']==3}
                <li class="group" style="color:white;background: #999;width: 38%"><a href="javascript:;" class="nav-controller"><i >￥{$goods['gprice']}</i>{$goods['groupnum']}人拼团</a><span class="qkt">已抢光</span></li>
                {/if}
                <li class="alone" style="width: 38%;background: #f3aba7"><a  style="color:white;" onclick='choose(1)' class="nav-controller"><i >￥{$goods['oprice']}</i>单独购买</a></li>
                {/if}
                {else}
                {if $goods['spikeT']==0}
                <li class="group" style="color:white;width: 38%;background: #e02e24"><a onclick='bb(2)'  class="nav-controller"><i >￥{$goods['gprice']}</i>{$goods['groupnum']}人拼团</a></li>
                <li class="alone" style="color:white;width: 38%"><a style="color:white;;background: #f3aba7" onclick='bb(1)'  class="nav-controller"><i >￥{$goods['oprice']}</i>单独购买</a></li>
                {else}
                {if $goods['spike_type']==0}
                <li class="group" style="color:white;background: #999;width: 38%"><a href="javascript:;"  class="nav-controller"><i >￥{$goods['gprice']}</i>未开始</a></li>
                {elseif $goods['spike_type']==1}
                <li class="group" style="color:white;width: 38%"><a onclick='bb(2)'  class="nav-controller"><i >￥{$goods['gprice']}</i>{$goods['groupnum']}人拼团</a></li>
                {elseif $goods['spike_type']==2}
                <li class="group" style="color:white;background: #999;width: 38%"><a href="javascript:;"  class="nav-controller"><i >￥{$goods['gprice']}</i>已结束</a></li>
                {elseif $goods['spike_type']==3}
                <li class="group" style="color:white;background: #999;width: 38%"><a href="javascript:;"  class="nav-controller"><i >￥{$goods['gprice']}</i>已抢光</a></li>
                {/if}
                <li class="alone" style="color:white;width: 38%;background: #f3aba7"><a style="color:white;" onclick='bb(1)'  class="nav-controller"><i >￥{$goods['oprice']}</i>单独购买</a></li>
                {/if}
                {/if}
                {else}
                <li class="group" style="width: 76%;;background: #e02e24"><a href="{php echo app_url('goods/list')}" style="line-height: 40px;font-size: 16px;" class="nav-controller external">已售罄，查看更多商品</a></li>
                {/if}
            </ul>
        </nav>
    </footer>
    <input type="hidden" id="buytype" value="" />
    <input type="hidden" id="buytype2" value="{$goods['groupnum']}" />
    <input type="hidden" id="optionid" name="optionid" value=""/>
</div>
</div>
<div class="link-rule" style="display:none;">
    <div>
        <div>拼团须知</div>
        <div>
            <div style="color:{$_W['system_color']};">什么是拼团？</div>
            <p>每个商品都有单独购买价和拼团价，当您通过拼团价购买时，开团支付成功后再邀请朋友参团，参团人数达到组团规定时，订单生效。在规定时间内，若人数不足组团失败，我们会在48小时内自动退款。</p>
            <div style="color:{$_W['system_color']};">如何拼团成功？</div>
            <p>拼团是基于好友的转发扩散，获取团购优惠。首先选择商品开团：选择拼团商品下单，团即刻开启，但团长完成支付，方能获取转发链接，并在团开启规定时间内邀请到相应人数的好友支付，此团方能成功。</p>
            <div style="color:{$_W['system_color']};">团长干嘛的？</div>
            <p>首先选择心仪的商品下单，并完成支付后即为团长。团长视为本次交易的发起人，且为第一位支付成功的成员。</p>
            <div style="color:{$_W['system_color']};">拼团成员是什么？</div>
            <p>通过分享出去的该团入口进入或者通过分享团入口进入并完成付款加入该团的团员，参团成员也可以将该团分享出去邀约更多的团员参团。</p>
            <div style="color:{$_W['system_color']};">拼团失败是怎么回事？</div>
            <p>从团长开团规定时间内未能找到相应开团人数的好友参团，则该团失败，系统会在48个小时内自动原路退款至你的支付账户中。</p>
        </div>
        <div id="link-know">已了解</div>
    </div>
</div>
<script>
    console.log('随意团限时 明择果园定制  goods_detail8');



    var options = {php echo json_encode($options)};  //2017年8月9日12:58:40


    var User = JSON.parse(localStorage.getItem("user"))|| {};
    var goodsid = document.getElementById("goodsid");
    var pricedown = document.getElementById("pricedown");
    var urlNotice = "{php echo app_url('goods/list/notice')}";
    var urlNoticeRemove = "{php echo app_url('goods/list/noticeremove')}";
    if (User[goodsid.innerHTML + "notice"]) {
        pricedown.style.backgroundColor = "#fcc602";
        pricedown.innerHTML = "等待<br/>通知";
    }
    document.getElementById("returnBack").onclick = function () {
        location.href = "{php echo app_url('goods_list')}";
    }
    pricedown.onclick = function() {
        if (pricedown.style.backgroundColor != "rgb(252, 198, 2)" && confirm("确认降价提醒么")) {
            postAjax(goodsid.innerHTML, urlNotice);
            pricedown.style.backgroundColor = "#fcc602";
            pricedown.innerHTML = "等待<br/>通知";
            User[goodsid.innerHTML + "notice"] = '1';
            localStorage.setItem("user",JSON.stringify(User));
        }
        else if (pricedown.style.backgroundColor == "rgb(252, 198, 2)" && confirm("确认取消降价提醒么")) {
            postAjax(goodsid.innerHTML, urlNoticeRemove);
            pricedown.style.backgroundColor = "{$_W['system_color']}";
            pricedown.innerHTML = "降价<br/>通知";
            delete User[goodsid.innerHTML + "notice"];
            localStorage.setItem("user",JSON.stringify(User));
        }
    }
    $("#up").on('click',function(){
        var num = $('#num').val();
        num = parseInt(num)+1;
        $('#num').val(num);
        var marketprice = 0;
        var productprice = 0;
        var options = {php echo json_encode($options)};
        var ret = option_selected();
        var len = options.length;
        for (var i = 0; i < len; i++) {
            var o = options[i];
            var ids = ret.all.join("_");
            if ((o.specs == ids)&&o.specs) {
                optionid = o.id;
                stock = o.stock;
                marketprice = o.marketprice;
                productprice = o.productprice;
                break;
            }
        }
        if(marketprice==0){
            marketprice = "{php echo $goods['gprice']}";
        }
        if(productprice==0){
            productprice = "{php echo $goods['oprice']}";
        }
        var goodsPrice=marketprice;
        var inputnum=num;
        var totalPrice = goodsPrice*inputnum;
        totalPrice = totalPrice.toFixed(2);
        $("#option_gprice").html(totalPrice);
        $("#option_oprice").html((productprice*inputnum).toFixed(2));
    });

    $("#down").on('click',function(){
        var num = $('#num').val();
        num = parseInt(num)-1;
        if(num<=0){
            num=1;
        }
        $('#num').val(num);
        var marketprice = 0;
        var productprice = 0;
        var options = {php echo json_encode($options)};
        var ret = option_selected();
        var len = options.length;
        for (var i = 0; i < len; i++) {
            var o = options[i];
            var ids = ret.all.join("_");
            if ((o.specs == ids)&&o.specs) {
                optionid = o.id;
                stock = o.stock;
                marketprice = o.marketprice;
                productprice = o.productprice;
                break;
            }
        }
        if(marketprice==0){
            marketprice = "{php echo $goods['gprice']}";
        }
        if(productprice==0){
            productprice = "{php echo $goods['oprice']}";
        }
        var goodsPrice=marketprice;
        var inputnum=num;
        var totalPrice = goodsPrice*inputnum;
        totalPrice = totalPrice.toFixed(2);
        $("#option_gprice").html(totalPrice);
        $("#option_oprice").html((productprice*inputnum).toFixed(2));
    });
    function isshow() {
        var canBuy = Number(document.getElementById("isshow").textContent);;
        return canBuy == 1 ? true : false;
    }
    function postAjax(id, url, weight, str){
        var formData = new FormData();
        formData.append('id', id);
        if (weight !== undefined) {
            formData.append("weight", weight);
        }else {
            formData.append("type", 2);
        }
        if (str !==undefined){
            formData.append("str",str);
        }
        var xhr = new XMLHttpRequest();
        xhr.open('post', url, true);
        xhr.send(formData);
        console.log(id + ' ' + weight + ' ' + str);
        xhr.onreadystatechange = function() {
            if (xhr.readyState ==4) {
                if ((xhr.status >=200 && xhr.status<300) || xhr.status ==304){
                    isPost = true;
                    console.log(xhr.responseText);
                    return !!xhr.responseText;
                }
                else {
                    alert("由于网络或其他原因导致无法购买,请关闭浏览器重试");
                    console.log("cuowu");
                }
            }
        }
    }
    var gohome = document.getElementById("gohome");
    gohome.onclick = function() {
        sessionStorage.removeItem("position");
    }
    document.getElementById("productInfott").innerHTML=escapeHtml("{$goods['gdesc']}");
    window.get_video();
    document.getElementById("link-know").onclick=function(){
        document.querySelector('.link-rule').style.setProperty("display","none");
    }
    document.getElementById("lookdetail").onclick=function(){
        document.querySelector('.link-rule').style.setProperty("display","block");
    }



    function bb(b){
        var many_limit = $("#many_limit").val();
        var one_limit = $("#one_limit").val();
        var times = $("#times").val();
        many_limit = parseInt(many_limit);
        one_limit=parseInt(one_limit);
        times=parseInt(times);
        if (isshow()) {
            if(b==1){
                location.href = "{php echo app_url('order/orderconfirm')}" + "&id=" + {$goods['id']}+ "&groupnum=1";
                //location.href = "{php echo app_url('order/orderconfirm',array(‘id’=>$goods['id'],'groupnum'=>1));}";
            }else{

                if(many_limit>=1){
                    if(times >= many_limit){
                        $.toast('单人购买总数为：'+many_limit+',您已购买'+times);
                        return false;
                    }
                }
                var nn = "{$goods['groupnum']}";

                location.href = "{php echo app_url('order/orderconfirm')}" + "&groupnum=" + nn+ "&id=" + {$goods['id']};
            }
        }
        else {
            $.toast("库存不足");
        }
    }
    $("#num").blur(function(){
        var inputnum=$("#num").val();
        var marketprice = 0;
        var productprice = 0;
        var options = {php echo json_encode($options)};

        var ret = option_selected();
        var len = options.length;
        for (var i = 0; i < len; i++) {
            var o = options[i];
            var ids = ret.all.join("_");
            if (o.specs == ids) {
                optionid = o.id;
                stock = o.stock;
                marketprice = o.marketprice;
                productprice = o.productprice;
                break;
            }
        }
        if(marketprice==0){
            marketprice = "{php echo $goods['gprice']}";
        }
        var goodsPrice=marketprice;
        var totalPrice = goodsPrice*inputnum;
        totalPrice = totalPrice.toFixed(2);
        $("#option_gprice").html(totalPrice);
    });


    $("#num2").blur(function(){
        var inputnum=$("#num2").val();
        var gp=$("#gn").val();
        gp = inputnum * gp;
        $("#option_price").html(gp);
    });

    $("#up2").bind('click',function(){
        var num = $('#num2').val();
        num = parseInt(num)+1;
        $('#num2').val(num);
        var gp=$("#gn").val();
        gp = num * gp;
        $("#option_price").html(gp);
    });

    $("#down2").bind('click',function(){
        var num = $('#num2').val();
        num = parseInt(num)-1;
        if(num<=0){
            num=1;
        }
        $('#num2').val(num);
        var gp=$("#gn").val();
        gp = num * gp;
        $("#option_price").html(gp);
    });
    var options = {php echo json_encode($options)};
    var specs = {php echo json_encode($specs)};
    var hasoption = {php echo $goods['hasoption'] == '1' ? 'true' : 'false'};

    var selected = [];
    function option_selected() {
        var ret = {
            no: "",
            all: []
        };
        var hasoption = {php echo $goods['hasoption'] == '1' ? 'true' : 'false'}; //放在上面,会undefined2017年8月9日13:02:06 
        if (!hasoption) {
            return ret;
        }
        $(".optionid").each(function (index,item) {
            ret.all.push($(item).val());
            if ($(this).val() == '') {
                ret.no = $(this).attr("title");
                return false;
            }
        })
        return ret;
    }
    function closechoose(){
        $('.footer').show();
        $('.good_choose_layer').fadeOut(100);
        $('.good_choose').fadeOut(100);
    }

    function exchange(numb) {
        $('#div_nav .boxx .sp').removeClass('on');
        $('.section_specification').removeClass('on');
        $('.section_detail').removeClass('on');
        $('a#shangpin'+numb).addClass('on');
        if(numb==0) {
            $('.section_specification').addClass('on');
        }else{
            $('.section_detail').addClass('on');
        }
    }

    function showStores(obj){
        if($(obj).attr('show')=='1'){
            $(obj).next('div').slideUp(100);
            $(obj).removeAttr('show').find('i').removeClass('fa-angle-down').addClass('fa-angle-up');
        }else{
            $(obj).next('div').slideDown(100);
            $(obj).attr('show','1').find('i').removeClass('fa-angle-up').addClass('fa-angle-down');
        }
    }
    function JTT() {
        var numPerson = document.getElementById("numPerson").textContent.split(",");
        var numPrices = document.getElementById("numPrices").textContent.split(",");
        var numGroup = document.getElementById("numGroup").textContent.split(",");
        var tuanPre = document.getElementById("tuanPre").textContent.split(",");
        var numTuan = tuanPre.length;
        var jtthtml = "";
        for (var j = 0; j < numTuan; j++) {
            jtthtml += '<div>'
                + '<div>'
                + '<div class="preTuan">团长:' + tuanPre[j] + '</div>'
                + '<div class="numTuan">参团人数:' + numGroup[j] + '人</div>'
                + '</div>'
                + '<div class="process">'
                + '<div class="progressBar"></div>'
                + '</div>'
                + '<div class="payToGroup">我要参团' + j + '</div>'
                + '</div>';
        }
        var clickPayHandler;
        clickPayHandler = function (ev) {
            alert(ev.target.textContent);
            //alert("去支付");
        }
        var module = {};
        module.numPerson = numPerson;
        module.numPrices = numPrices;
        module.numTuan = numTuan;
        module.init = function() {
            var jieTiGroup = document.getElementById("jieTiGroup");
            jieTiGroup.insertAdjacentHTML('beforeend', jtthtml);
            for (var j = 0; j < this.numTuan; j++) {
                var progressBar = jieTiGroup.getElementsByClassName("progressBar")[j];
                progressBar.style.width = Math.round(Number(numGroup[j]) *100 / (Number(this.numPerson[this.numPerson.length - 1]) * 1.1)) + "%";
                var process = jieTiGroup.getElementsByClassName("process")[j];
                var payToGroup = jieTiGroup.getElementsByClassName("payToGroup")[j];
                payToGroup.onclick = clickPayHandler;
                for (var i = 0; i < this.numPerson.length; i++) {
                    var div = document.createElement("div");
                    div.className = "progressStep";
                    div.style.right = Math.round(101 - Number(this.numPerson[i]) * 100 / (Number(this.numPerson[this.numPerson.length - 1]) * 1.1))  + "%";
                    div.innerHTML = '<div>'+ this.numPerson[i] +'</div><div>'+ this.numPrices[i]+'</div>';
                    process.appendChild(div);
                }
            }
        }

        return module;
    }
    //	$('.huifu').on('click',function(e){
    //		console.log($(e));
    //		console.log($(this));
    //		$(e).next().next().slideToggle();
    //	})

</script>
<script>
    function escape2Html(str){
        var arrEntities={'lt':'<','gt':'>','nbsp':' ','amp':'&','quot':'"'};
        return str.replace(/&(lt|gt|nbsp|amp|quot);/ig,function(all,t){return arrEntities[t];});
    }
    $(".editor").html(escape2Html("{$goods['goodsdesc']}"));
</script>
<script>
    //开始时间
    var startT = "{php echo $goods['spike_start']}"*1000;
    var time = new Date(startT);
    var starty = time.getFullYear();
    var startm = time.getMonth()+1;
    var startd = time.getDate();
    var starth = time.getHours();
    var startmm = time.getMinutes();
    var starts = time.getSeconds();
    $(".startT h6").html('<span>' + add0(starty) + '/' + add0(startm) + '/' + add0(startd) + '</span><b> </b><span>' + add0(starth) + '</span><b>:</b><span>' + add0(startmm) + '</span><b>:</b><span>00</span>');
    //结束时间
    var endT = "{php echo $goods['spike_end']}"*1000;
    var time = new Date(endT);
    var endy = time.getFullYear();
    var endm = time.getMonth()+1;
    var endd = time.getDate();
    var endh = time.getHours();
    var endmm = time.getMinutes();
    var ends = time.getSeconds();
    $(".endT h6").html('<span>' + add0(endy) + '/' + add0(endm) + '/' + add0(endd) + '</span><b> </b><span>' + add0(endh) + '</span><b>:</b><span>' + add0(endmm) + '</span><b>:</b><span>00</span>');


    if({$goods['spike_type']}!=0) {
        //剩余时间
        FreshTime();
        setInterval(function () {
            FreshTime();
        }, 400);
    }else{
        FreshTime('weikaishi');
        setInterval(function () {
            FreshTime('weikaishi');
        }, 400);
    }

    function add0(m){return m<10?'0'+m:m }
    function FreshTime(a) {
        var str ="{php echo date('Y-m-d H:i:s',$goods['spike_start'])}";
        //alert('{php echo date('Y-m-d H:i:s',$tuaninfo['endtime'])}');
        var lasttime = "{php echo $goods['spike_end']}" - "{php echo $goods['spike_start']}";
        str = str.replace(/-/g, "/");
        var starttime = new Date(str);//开始时间
        var nowtime = new Date();//当前 时间
        var now_time = nowtime.getTime();
        var start_time = starttime.getTime();
        if(a=='weikaishi'){//未开始状态 倒计时计算方式
            var lefttime = -(now_time - start_time) / 1000; //计算剩余时间\
        }else {
            var lefttime = lasttime - ((now_time - start_time) / 1000); //计算剩余时间\
        }
        if (now_time >= {php echo $goods['spike_end'] * 1000}) {
            {if $goods['iskj']!=1}
            $('.alone').css('background', '#bbb').css('padding-top', '15px').html('已售罄');
            $('.alone').off('click');
            {/if}
            }

            if (lefttime > 0&&({$goods['gnum']}!=0)) {

                dd = parseInt(lefttime/(24*60*60)); //计算剩余的天数
                hh = parseInt(lefttime/(60*60)%24); //计算剩余的小时 ;
                mm = parseInt((lefttime / 60) % 60);
                ss = parseInt(lefttime % 60);
                $(".T_time div").html('<span>' + add0(dd) + '</span>天<span>' + add0(hh) + '</span>时<span>' + add0(mm) + '</span>分<span>' + add0(ss) + '</span>秒');
            } else {
                {if $goods['iskj']!=1}
                $('li.group a').removeAttr('href').removeAttr('onclick').off();
                $('.footer .group').css('background','#aaa');
                $('.qkt').html('已结束');
                $(".T_time div").html('<span>00</span>天<span>00</span>时<span>00</span>分<span>00</span>秒');
                {/if}
                }
            }
    function groupLeftTime () {
        var nowtime = new Date();//当前 时间
        var now_time = nowtime.getTime();
        var ht_time_arr = $('.ht_time');
        for(var i = 0,len = ht_time_arr.length; i< len; i++) {
            var group_endTime = ht_time_arr.eq(i).attr('data_endTime');
            var lefttime =(Number(group_endTime)*1000 - now_time) / 1000;
            if(lefttime > 0) {
                dd = parseInt(lefttime/(24*60*60)); //计算剩余的天数
                hh = parseInt(lefttime/(60*60)%24); //计算剩余的小时 ;
                mm = parseInt((lefttime / 60) % 60);
                ss = parseInt(lefttime % 60);
                ht_time_arr.eq(i).html('<span>' + add0(dd) + '</span>天<span>' + add0(hh) + '</span>时<span>' + add0(mm) + '</span>分<span>' + add0(ss) + '</span>秒');
            } else {
                ht_time_arr.eq(i).html('<span>团已结束</span>');
            }
        }
    }
    groupLeftTime();
    setInterval(function () {
        groupLeftTime();
    }, 400);
</script>
{php include wl_template('common/footer');}