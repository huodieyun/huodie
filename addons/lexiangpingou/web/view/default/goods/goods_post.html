{php include wl_template('common/header');}
<style>
	#Choose{
		position: fixed;
		z-index: 100;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-color: rgba(0,0,0,0.7);
		display: none;
	}
	#Choose>div{
		width:65%;
		height: 68%;
		margin-top: 5%;
		margin-left: 20%;
		padding: 20px;
		background-color: #f0f0f0;
		border-radius: 5px;
	}

	a.thumbnail{
		width: 150px;
		height: 200px;
		display: inline-block;
		border: 4px solid #aaa;
		margin: 0 15px 20px 15px;
		padding: 0;
	}
	a.thumbnail.active,a.thumbnail:hover,a.thumbnail:focus{
		border: 4px solid #f68e3a;
	}
	.thumbnail>img{
		width: 100%;
		height: 100%;
	}
	@media screen  and (max-width: 1600px){
		.thumbnail{
			width: 90px!important;
			height: 120px!important;
			margin: 0 15px 10px 15px!important;
		}
		#Choose>div{
			padding: 10px 20px!important;
		}
	}
</style>

<!--<ul class="nav nav-tabs" id="myTab">-->
<!--<li class="active" ><a href="#tab_basic">基本信息</a></li>-->
<!--<li><a href="#tab_detail">简介详情</a></li>-->
<!--<li><a href="#tab_concessions">促销方式</a></li>-->
<!--<li><a href="#tab_hexiao">配送方式</a></li>-->
<!--<li {if !$isoption['status']} style="display:none"{/if}><a href="#tab_option">规格库存</a></li>-->
<!--<li><a href="#tab_share">分享设置</a></li>-->
<!--<li><a href="#tab_param">商品属性</a></li>-->
<!--<li {if !$isjieti['status']} style="display:none"{/if}><a href="#tab_level">阶梯/自选团</a></li>-->
<!--<li><a href="#tab_luck">奖项设置</a></li>-->
<!--</ul>-->
<div class="main">
	<div id="Choose">
		<div>
			<div style="text-align: center;margin-bottom: 20px;position: relative">
				<h2>选择销售模式</h2>
				<div class="glyphicon glyphicon-question-sign" style="position: absolute;top: 0;right: 20%;padding: 10px;cursor: pointer;"></div>
				<img src="{TG_URL_WRES}images/goospostewm.png" alt="" style="position: absolute;top: 0;right: 3%;display: none">
			</div>
			<div>
				<div class="row" style="text-align: center">
					<div>
						{if $isshop==1}
						<a data-val="0" href="#" class="thumbnail">
							<img src="../../../../../../addons/lexiangpingou/web/resource/images/dm.png" alt="...">
						</a>
						{/if}
						<a data-val="1" href="#" class="thumbnail">
							<img src="../../../../../../addons/lexiangpingou/web/resource/images/sy.png" alt="...">
						</a>
						{if $islin['status']}
						<a data-val="2" href="#" class="thumbnail">
							<img src="../../../../../../addons/lexiangpingou/web/resource/images/lg.png" alt="...">
						</a>
						{/if}
						{if $isjieti['status']}
						<a data-val="3" href="#" class="thumbnail">
							<img src="../../../../../../addons/lexiangpingou/web/resource/images/zx.png" alt="...">
						</a>
						{/if}
					</div>
				</div>
				<div class="row" style="text-align: center">
					<div>
						{if $isjieti['status']}
						<a data-val="4" href="#" class="thumbnail">
							<img src="../../../../../../addons/lexiangpingou/web/resource/images/jt.png" alt="...">
						</a>
						{/if}
						{if $ischoujian['status']}
						<a data-val="5" href="#" class="thumbnail">
							<img src="../../../../../../addons/lexiangpingou/web/resource/images/cj.png" alt="...">
						</a>
						<a data-val="6" href="#" class="thumbnail">
							<img src="../../../../../../addons/lexiangpingou/web/resource/images/xz.png" alt="...">
						</a>
						{/if}
						{if $isjieti2['status']}
						<a data-val="7" href="#" class="thumbnail">
							<img src="../../../../../../addons/lexiangpingou/web/resource/images/dj.png" alt="...">
						</a>
						{/if}
					</div>
				</div>
			</div>
			<div style="text-align: center;margin-top: 10px">
				<a style="width: 150px" href="##" class="btn btn-primary chooseType">确定</a>
			</div>
		</div>
	</div>
	<form action="" method="post" class="form-horizontal form" id="form" style="position: relative">
		<div class="tab-content">

			<!--商品信息-->
			<div class="tab-pane  active" id="tab_basic">
				<script>
                    sessionStorage.setItem('selltypeOld',"{$goods['selltype']}");
				</script>
				<?php
				 if(empty($_GPC['selltype'])){
				 	$_GPC['selltype']=intval($goods['selltype']);
				 }else{
				 	$_GPC['selltype']-=1;
				 }
				?>
				{if $_GPC['selltype']==0}
				{php include wl_template('goods/goods_basicDanMai');}
				{else if $_GPC['selltype']==1}
				{php include wl_template('goods/goods_basicSuiYiT');}
				{else if $_GPC['selltype']==2}
				{php include wl_template('goods/goods_basicLinGouT');}
				{else if $_GPC['selltype']==3}
				{php include wl_template('goods/goods_basicZiXuanT');}
				{else if $_GPC['selltype']==4}
				{php include wl_template('goods/goods_basicJieTiT');}
				{else if $_GPC['selltype']==5}
				{php include wl_template('goods/goods_basicChouJiangT');}
				{else if $_GPC['selltype']==6}
				{php include wl_template('goods/goods_basicXinZhuanT');}
				{else if $_GPC['selltype']==7}
				{php include wl_template('goods/goods_basicDingJinT');}
				{/if}
				<div class="col-sm-12">
					<a href="##" class="btn btn-primary col-lg-1 XinXi" onclick="checkStartSpike();gotoNext(this);">下一步</a>
				</div>
			</div>

			<!--奖项设置-->
			<div class="tab-pane" id="tab_luck">
				<div class="panel panel-default">
					<div class="panel-heading">奖项设置</div>
					<div class="panel-body">
						<div class="panel-body">
							{php include wl_template('goods/goods_luck');}
						</div>
					</div>
				</div>
				<div class="col-sm-12">
					<a href="##" class="btn btn-primary col-lg-1" style="margin-right:20px;"  onclick="gotoPrev(this)">上一步</a>
					<a href="##" class="btn btn-primary col-lg-1" onclick="gotoNext(this)">下一步</a>
				</div>
			</div>

			{if $isoption['status']}
			{if $goods['supply_goodsid'] == 0 || ($goods['supply_goodsid'] && $goods['hasoption'] == 1)}
			<div class="tab-pane" id="tab_option">
				<div class="panel panel-default">
					<div class="panel-heading">规格库存
						<a target="_blank" style="cursor:pointer; float:right; font-weight:bold;" href="http://v.youku.com/v_show/id_XMTc0OTkwNzY2MA==.html?from=s1.8-1-1.2&spm=a2h0k.8191407.0.0">视频演示>></a>
						<a target="_blank" style="cursor:pointer; float:right; margin-right:10px; font-weight:bold;" href="http://doc.lexiangpingou.cn/releaseProduct.html#ggkc">图文说明>></a>
					</div>
					<div class="panel-body">
						<div class="panel-body">
							{php include wl_template('goods/goods_option');}
						</div>
					</div>
				</div>
				<div class="col-sm-12">
					<a href="##" class="btn btn-primary col-lg-1" style="margin-right:20px;"  onclick="gotoPrev(this)">上一步</a>
					<a href="##" class="btn btn-primary col-lg-1 GuiGe" onclick="gotoNext(this)">下一步</a>
				</div>
			</div>
			{/if}
			{/if}

			<!--配送方式		-->
			{if !$goods['supply_goodsid']}
			<div class="tab-pane" id="tab_hexiao">
				<div class="panel panel-default">
					<div class="panel-heading">配送方式<a target="_blank" style="cursor:pointer; float:right; font-weight:bold;" href="http://doc.lexiangpingou.cn/releaseProduct.html#psfs">图文说明>></a></div>
					<div class="panel-body">
						<div class="panel-body">
							{php include wl_template('goods/goods_hexiao');}
						</div>
					</div>
				</div>
				<div class="col-sm-12">
					<a href="##" class="btn btn-primary col-lg-1" style="margin-right:20px;"  onclick="gotoPrev(this)">上一步</a>
					<a href="##" class="btn btn-primary col-lg-1 PeiSong" onclick="gotoNext(this)">下一步</a>
				</div>
			</div>
			{/if}
			<!--促销方式		-->
			<div class="tab-pane" id="tab_concessions">
				<div class="panel panel-default">
					<div class="panel-heading">促销方式<a target="_blank" style="cursor:pointer; float:right; font-weight:bold;" href="http://doc.lexiangpingou.cn/releaseProduct.html#cxfs">图文说明>></a></div>
					<div class="panel-body">
						<div class="panel-body">
							{php include wl_template('goods/goods_concessions');}
						</div>
					</div>
				</div>
				<div class="col-sm-12">
					<a href="##" class="btn btn-primary col-lg-1" style="margin-right:20px;"  onclick="gotoPrev(this)">上一步</a>
					<a href="##" class="btn btn-primary col-lg-1 CuXiao" onclick="gotoNext(this)">下一步</a>
				</div>
			</div>


			<!--阶梯团-->
			<div class="tab-pane" id="tab_level" {if !$isjieti['status']} style="display:none"{/if}>
			<div class="panel panel-default">
				<div class="panel-heading">阶梯团<a target="_blank" style="cursor:pointer; float:right; font-weight:bold;" href="http://doc.lexiangpingou.cn/releaseProduct.html#jtt">图文说明>></a></div>
				<div class="panel-body">
					<div class="panel-body">
						{php include wl_template('goods/goods_level');}
					</div>
				</div>
			</div>
			<div class="col-sm-12">
				<a href="##" class="btn btn-primary col-lg-1" style="margin-right:20px;"  onclick="gotoPrev(this)">上一步</a>
				<a href="##" class="btn btn-primary col-lg-1" onclick="gotoNext(this)">下一步</a>
			</div>
			<div class="col-sm-12">
				<a href="##" class="btn btn-primary col-lg-1" style="margin-right:20px;"  onclick="gotoPrev(this)">上一步</a>
				<a href="##" class="btn btn-primary col-lg-1" onclick="gotoNext(this)">下一步</a>
			</div>
		</div>

		<!--商品属性-->
		<div class="tab-pane" id="tab_param">
			<!-- 多门店规格库存设置-->
			{if $goods['selltype']!=4 && $goods['selltype']!=7}
			<div class="tab-pane" id="stores_stock_setting">
				<div class="panel panel-default">
					<div class="panel-heading">多门店规格库存设置<a target="_blank" style="cursor:pointer; float:right; font-weight:bold;" href="https://doc.lexiangpingou.cn/releaseProduct.html#fxsz">图文说明>></a></div>
					<div class="panel-body">
						<a href="javascript:;" onclick="renderStock()" class="btn btn-primary"><i class="fa fa-refresh"></i>多门店库存设置</a>
						<div class="table-responsive" id="store_stock" style="padding: 0;">
							{if $goods['hasoption'] == 1}
							{$store_html}
							{/if}
						</div>
					</div>
				</div>
			</div>
			{/if}
			<!--分享设置		-->
			<div class="tab-pane" id="tab_share">
				<div class="panel panel-default">
					<div class="panel-heading">分享设置<a target="_blank" style="cursor:pointer; float:right; font-weight:bold;" href="http://doc.lexiangpingou.cn/releaseProduct.html#fxsz">图文说明>></a></div>
					<div class="panel-body">
						<div class="panel-body">
							{php include wl_template('goods/goods_share');}
						</div>
					</div>
				</div>
			</div>


			<div class="panel panel-default">
				<div class="panel-heading">商品属性<a target="_blank" style="cursor:pointer; float:right; font-weight:bold;" href="http://doc.lexiangpingou.cn/releaseProduct.html#spsx">图文说明>></a></div>
				<div class="panel-body">
					<div class="panel-body">
						{php include wl_template('goods/goods_param');}
					</div>
				</div>
			</div>
			<div class="panel panel-default">
				<div class="panel-heading">商品服务<a target="_blank" style="cursor:pointer; float:right; font-weight:bold;" href="http://doc.lexiangpingou.cn/releaseProduct.html#spsx">图文说明>></a></div>
				<div class="panel-body">
					<div class="panel-body">
						{php include wl_template('goods/goods_servies');}
					</div>
				</div>
			</div>
			<!--商品详情-->
			<div class="tab-pane" id="tab_detail">
				<div class="panel panel-default">
					<div class="panel-heading">商品详情<a target="_blank" style="cursor:pointer; float:right; font-weight:bold;" href="http://doc.lexiangpingou.cn/releaseProduct.html#jjxq">图文说明>></a></div>
					<div class="panel-body">
						<div class="panel-body">
							{php include wl_template('goods/goods_detail');}
						</div>
					</div>
				</div>
			</div>
			<!--简介详情-->
			<div class="tab-pane">
				<div class="panel panel-default">
					<div class="panel-heading"><a href="javascript:;" onclick="editjj()">编辑详情简介</a> <a target="_blank" style="cursor:pointer; float:right; font-weight:bold;" href="http://doc.lexiangpingou.cn/releaseProduct.html#jjxq">图文说明>></a></div>
					<input type="text" name="isGo" value="0" hidden>
				</div>
			</div>
			<div class="col-sm-12">
				<a href="##" class="btn btn-primary col-lg-1" style="margin-right:20px;"  onclick="gotoPrev(this)">上一步</a>
				<input class="TJButtonSX" type="hidden" name="id" value="{$goods['id']}" />
				<input type="submit" name="submit" value="提交" class="btn btn-primary col-lg-1 TJButtonSX" />
				<input class="TJButtonSX" type="hidden" name="token" value="{$_W['token']}" />
			</div>
		</div>

</div>
<div class="form-group col-sm-12 TJButtonCom">
	<input type="hidden" name="id" value="{$goods['id']}" />
	<input type="submit" name="submit" value="提交" class="btn btn-primary col-lg-1" style="float: left;position: relative;top: -34px;left:245px;"/>
	<input type="hidden" name="token" value="{$_W['token']}" />
</div>
</form>

</div>
<script>
	function renderStock() {
		var storeList = [];
		if($('input[name="goods[selltype]"]:checked').val() > 0) {
			$('input[name="storeids[]"]').each(function() {
				var onSeletedStoreName = $(this).attr('data-name');
				var storeId = $(this).val();
				storeList.push({storename: onSeletedStoreName, id: storeId})
			})
		} else {
		  storeList = {php echo json_encode($store_list)}
		}

		window.optionchanged = false;
		var html = '<table class="table table-bordered table-condensed"><thead><tr class="active">';
		var specs = [];
		$(".spec_item").each(function(i){
			var _this = $(this);

			var spec = {
				id: _this.find(".spec_id").val(),
				title: _this.find(".spec_title").val()
			};

			var items = [];
			_this.find(".spec_item_item").each(function(){
				var __this = $(this);
				var item = {
					id: __this.find(".spec_item_id").val(),
					title: __this.find(".spec_item_title").val(),
					show:__this.find(".spec_item_show").get(0).checked?"1":"0"
				};
				items.push(item);
			});
			spec.items = items;
			specs.push(spec);
		});
		specs.sort(function(x,y){
			if (x.items.length > y.items.length){
				return 1;
			}
			if (x.items.length < y.items.length) {
				return -1;
			}
		});
		specs.unshift(storeJoinSpecs(storeList));
		var len = specs.length;
		var newlen = 1; //多少种组合
		var h = new Array(len); //显示表格二维数组
		var rowspans = new Array(len); //每个列的rowspan
		for(var i=0;i<len;i++){
			//表头
			html+="<th style='width:80px;'>" + specs[i].title + "</th>";

			//计算多种组合
			var itemlen = specs[i].items.length;
			if(itemlen<=0) { itemlen = 1 };
			newlen*=itemlen;

			//初始化 二维数组
			h[i] = new Array(newlen);
			for(var j=0;j<newlen;j++){
				h[i][j] = new Array();
			}
			//计算rowspan
			var l = specs[i].items.length;
			rowspans[i] = 1;
			for(j=i+1;j<len;j++){
				rowspans[i]*= specs[j].items.length;
			}
		}

		html += '<th class="info" style="width:130px;"><div class=""><div style="padding-bottom:10px;text-align:center;font-size:16px;">库存</div><div class="input-group"><input type="text" class="form-control store_stock_all"VALUE=""/><span class="input-group-addon"><a href="javascript:;" class="fa fa-hand-o-down" title="批量设置" onclick="setCol(\'store_stock\');"></a></span></div></div></th>';
		html+='</tr></thead>';

		for(var m=0;m<len;m++){
			var k = 0,kid = 0,n=0;
			for(var j=0;j<newlen;j++){
				var rowspan = rowspans[m]; //9
				if( j % rowspan==0){
					h[m][j]={title: specs[m].items[kid].title, html: "<td rowspan='" +rowspan + "'>"+ specs[m].items[kid].title+"</td>\r\n",id: specs[m].items[kid].id};
				//	k++; if(k>specs[m].items.length-1) { k=0; }
				}
				else{
					h[m][j]={title:specs[m].items[kid].title, html: "",id: specs[m].items[kid].id};
				}
				n++;
				if(n==rowspan){
				kid++; if(kid>specs[m].items.length-1) { kid=0; }
				n=0;
				}
			}
		}


		var hh = "";
		for(var i=0;i<newlen;i++){
			hh+="<tr>";
			var ids = [];
			var titles = [];
			for(var j=0;j<len;j++){
				hh+=h[j][i].html; //每一行的每个规格项列
				ids.push( h[j][i].id);
				titles.push( h[j][i].title);
			}
			ids =ids.join('_');
			titles= titles.join('+');

			var val ={ id : "",title:titles, stock : ""};
			if( $(".store_id_" + ids).length>0){
				val ={
					id : $(".store_id_" + ids+":eq(0)").val(),
					title: titles,
					stock : $(".store_stock_id_" + ids+":eq(0)").val(),
				}
			}
			hh += '<td class="info">'
			hh += '<input {if $goods['supply_goodsid']}readonly{/if} name="store_stock_id_' + ids +'[]"type="text" class="form-control store_stock store_stock_id_' + ids +'" value="' +(val.stock=='undefined'?'':val.stock )+'"/></td>';
			hh += '<input name="store_id[]" type="hidden" class="form-control option_id store_id_' + ids +'" value="'+ids+'"/>';
		}
		html+=hh;
		html+="</table>";
		$('#store_stock').html(html);
	}


	function storeJoinSpecs(arr) {
		var spec = {
				id: 112122121212,
				title: '门店'
			};
		var items = [];
		arr.forEach(function (item) {
			var item = {
				id: item.id,
				title: item.storename,
				show: '1'
			};
			items.push(item);
		})
		spec.items = items;
		return spec;
	}

	$('.glyphicon-question-sign').mouseover(function () {
	    $(this).next().show();
    });
    $('.glyphicon-question-sign').mouseout(function () {
        $(this).next().hide();
    });


    if(getQueryString('selltype')){
        if(getQueryString('selltype')=='100'){
            $('#Choose').fadeIn();
        }
        $('.TJButtonCom').remove();
//		$('#Choose').fadeIn();

    }else{
        $('.TJButtonSX').remove();
    }
    $('#Choose a[data-val="'+sessionStorage.getItem('selltypeOld')+'"]').addClass('active');
    $('#Choose').on('click','.thumbnail',function(){
        $('#Choose .thumbnail').removeClass('active');
        $(this).addClass('active');
    });
    $('.chooseType').click(function(){
        var raInput=$('#Choose .thumbnail');
        var j= 0,ij;
        for(var i=0;i<raInput.length;i++){
            if($(raInput[i]).hasClass('active')){
                j++;
                ij=$(raInput[i]).attr('data-val');
            }
        }
        if(j==0){
            util.tips("请选择购买模式");
            return false;
        }
        location.href="{php echo web_url('goods/goods', array('op' => 'post','id' => $goods['id']))}"+'&selltype='+(ij-0+1);
    });
    //获取url参数
    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return decodeURI(r[2]); return null;
    }
    var sTYPE=getQueryString('selltype');
    var sT=sTYPE||(sessionStorage.getItem('selltypeOld')-0+1);
    $('#chooseMS label>input').attr('disabled','');
    $('#chooseMS label>input[value="'+(sT-1)+'"]').attr('checked','checked').removeAttr('disabled');
    var switchType=sTYPE?(sTYPE-1):Number({$goods['selltype']});
    function checkStartSpike () {
    	if (switchType == 0){
			if ("{php echo $_W['account']['vip']}" != '1' || $('input[name="spike"]:checked').val() != '1') {
				$('#tab_hexiao').remove();
			}
		}
	}
    switch (switchType)
    {
        case 0://单买
            $('#tab_level,#tab_luck').remove();
            break;
        case 1://随意
            $('#tab_level,#tab_luck').remove();
            break;
        case 2://邻购
            $('#tab_level,#tab_luck').remove();
            break;
        case 3://自选
            $('#tab_option,#tab_level,#tab_luck').remove();
            break;
        case 4://阶梯
            $('#tab_option,#tab_level,#tab_luck').remove();
            break;
        case 5://抽奖
            $('#tab_level').remove();
            break;
        case 6://新专
            $('#tab_level,#tab_luck').remove();
            break;
        case 7://订金
            $('#tab_option,#tab_level,#tab_luck').remove();
            break;
        default:
            $('#tab_level,#tab_luck').remove();
            break;
    }
    function checkStoreVal() {
        if (document.getElementById("hasoption")){
            var option = document.getElementById("hasoption"),
                storeNum = document.querySelector("input[name='goods[gnum]']");
            if (document.getElementById("hasoption").checked) {
                var optionStocks = document.getElementsByClassName("option_stock"),
                    len = optionStocks.length,
                    sum = 0;
                for (var i = 0; i < len; i++) {
                    sum += Number(optionStocks[i].value);
                }
                storeNum.value = sum;

                if(document.getElementById("collapseOne")) {
                	document.getElementById("collapseOne").remove();
                }
            }
        }
    }
    function checkJttValue() {
        var price = document.querySelector('[name="goods[gprice]"]').value;
        var groupNum = document.querySelector('[name="goods[groupnum]"]').value;
        if (document.querySelector('input[value="2"][name="goods[group_level_status]"]').checked) {
            var gprice = document.querySelector(".param_value").value;
            var gnums = document.querySelectorAll(".param_title");
            var groupnum = gnums[gnums.length - 1].value;
            if (Number(price) == Number(gprice) && Number(groupNum) == Number(groupnum)) {
                return true;
            }
            else {
                return false;
            }
        }
        else {
            return true;
        }
    }
    $(function () {
        window.optionchanged = false;
        $('#myTab a').click(function (e) {
            e.preventDefault();//阻止a链接的跳转行为
            $(this).tab('show');//显示当前选中的链接及关联的content
        })
    });
    $(function(){
        $('#form').submit(function(self){
            if($('input[name="goods[share_image]"]').val()==""){
                util.message('请上传分享图片');
                return false;
            }
            if ($('input[name="goods[community]"]:checked').val() == '0') {
            	$('input[name="goods[is_daiqian]"]').eq(1).attr('checked','checked');
            }
            if (document.getElementById("hasoption")){
	            if($('#hasoption')[0].checked){
	                if($('#options table').length>0) {
	                    for (var i = 0; i < $('#options tbody input[type="text"]').length; i++) {
	                        if ($('#options tbody input[type="text"]')[i].value == '') {
	                            util.message('请填写规格数据');
	                            return false;
	                        }
	                    }
	                    $('.store_gnum').remove();
	                    if ($('input[name="goods[has_store_stock]"]:checked').val() == '1' && $('input[name="store_id[]"]').length == 0) {
	                    	util.message('开启多门店库存设置后，要填写具体的门店库存，在商品编辑的最后一步，点击多门店库存设置');
	                        return false;
	        			}
	                }else{
	                    util.message('请填写规格数据');
	                    return false;
	                }
	            } else {
	            	$('#stores_stock_setting').remove();
	            }
        	}
            if (Number($('input[name="goods[gnum]"]').val())<Number($('input[name="goods[groupnum]"]').val())) {
                util.message('库存数不能少于起团人数');
                return false;
            }
            var media_id = $("input[name=wechat-video]").attr("meadia_id");//获取mediaid
            $("#media_id").attr("value",media_id);
            //获取url
            var url = $("input[name=wechat-video]").attr("url");
            $("#video_url").attr("value",url);
//			$('input[name="submit"]').attr('disabled','');
            checkStoreVal();
            // 配送方式判断
            for(var i=0;i<$('#tab_hexiao .radio>input').length;i++){
                if($('#tab_hexiao .radio>input')[i].checked){
                    var num=Number($($('#tab_hexiao .radio>input')[i]).attr('data-val'));
                    if(num==1||num==7){
                        if($('#dispatch input').length<1){
                            util.message('请选择运费模板');
                            return false;
                        }
                        if($('#stores input').length<1){
                            util.message('请选择自提门店');
                            return false;
                        }
                    }else if(num==2||num==4){
                        if($('#dispatch input').length<1){
                            util.message('请选择运费模板');
                            return false;
                        }
                    }else if(num==3||num==6){
                        if($('#stores input').length<1){
                            util.message('请选择自提门店');
                            return false;
                        }
                    }
                }
            }
            return true;
        });
    });


    function gotoPrev(self){//上一页
        $('.tab-content>.tab-pane').removeClass('active');
        var tab = $("input[name='goods[is_wholesale]']:checked").val();
        var activeTab = $(self).parents('.tab-pane').attr('id');
        if (tab == "1" && activeTab == "tab_concessions") {
            $(self).parent().parent().prev().prev().addClass('active');
        } else {
            $(self).parent().parent().prev().addClass('active');
        }
    }
    function gotoNext(self){//下一页
    	if($('input[name="goods[has_store_stock]"]:checked').val() == '0') {  //多门店库存
        	$('input.store_gnum').css("display","none");
        	$('#stores_stock_setting').css("display", "none");
        }else {
        	$('input.store_gnum').css("display","block");
        	if (document.getElementById("hasoption")){
	        	if($('#hasoption')[0].checked) {
	        		$('input.store_gnum').css("display","none");
	        		$('#stores_stock_setting').css("display", "block");
	        	}else {
	        		$('#stores_stock_setting').css("display", "none");
	        	}
        	}
        }

        if($(self).hasClass('XinXi')) {//商品属性页
            //公用判断
            if(!$('select[name="goods[fk_typeid]"]').val()){
                util.message('请填写商品分类');
                return false;
            }
            if ($('input[name="goods[gname]"]').val() == '') {
                util.message('请填写商品名称');
                return false;
            }
            if ($('input[name="goods[gname]"]').val().length > 30) {
                util.message('为保证支付正常，商品名称字数不能大于30个字');
                return false;
            }
            if ($('input[name="goods[unit]"]').val() == '') {
                util.message('请填写商品单位');
                return false;
            }
            if ($('input[name="goods[gnum]"]').val() == ''||$('input[name="goods[gnum]"]').val() == ''<0) {
                util.message('请填写商品库存');
                return false;
            }
            if ($('input[name="goods[oprice]"]').val() == ''||$('input[name="goods[oprice]"]').val()<0) {
                util.message('请填写商品单买价');
                return false;
            }
            if ($('input[name="goods[mprice]"]').val() == ''||$('input[name="goods[mprice]"]').val()<0) {
                util.message('请填写商品市场价');
                return false;
            }
            if ($('input[name="goods[gimg]"]').val() == '') {
                util.message('请上传首页图片');
                return false;
            }


            var type = getQueryString('selltype')?(getQueryString('selltype')-1):(sessionStorage.getItem('selltypeOld')-0);
            if (type == 0) {//单买
                $('.DJdanmai,.pic,.tzyj').css('display','none');
            } else if (type == 1 || type == 2 || type == 5 || type == 6) {
            	if(type == 2) {
            		$('input[name="goods[is_commander_fee]"]').click();
            		$('.tzmd').hide();
            	}
                if ($('input[name="goods[gprice]"]').val() == ''||$('input[name="goods[gprice]"]').val()<=0) {
                    util.message('请填写团购价');
                    return false;
                }
                if ($('input[name="goods[groupnum]"]').val() == ''||$('input[name="goods[groupnum]"]').val()<1) {
                    util.message('请填写起团人数');
                    return false;
                }
                if ($('input[name="endtime"]').val() == ''||$('input[name="endtime"]').val()<1) {
                    util.message('请填写组团限时');
                    return false;
                }
            } else if (type == 3 ||type == 4) {//阶梯
                if(type == 4){
                    $('.DJdanmai,.pic,.yjms,.yjjsfs,.yj,.comtype').css('display','none');
                    $('input[name="goods[show_com]"]').click();
					$('input[name="goods[is_commander_fee]"]').click();
					$('input[name="goods[com_type]"]').click();
					$('input[name="goods[commissiontype]"]').click();
                }
                if ($('#param-items-level tr').length < 1) {
                    util.message('请添加阶梯数据');
                    return false;
                }
                if ($('#param-items-level input[name="param_groupnum[]"]').val() == '' || $('#param-items-level input[name="param_groupprice[]"]').val() == '') {
                    util.message('阶梯数据不能为空');
                    return false;
                }
                if ($('input[name="endtime"]').val() == ''||$('input[name="endtime"]').val()<1) {
                    util.message('请填写组团限时');
                    return false;
                }
            }else if (type == 7) {//订金
                //$('.DJdanmai,.DMdanmai,.pic').css('display','none');
                $('.pic,.yjms,.yjjsfs,.yj,.comtype').css('display','none');
                $('input[name="goods[show_com]"]').click();
				$('input[name="goods[is_commander_fee]"]').click();
				$('input[name="goods[com_type]"]').click();
				$('input[name="goods[commissiontype]"]').click();
				$('input[name="goods[commission]"]').val('');
                if ($('input[name="goods[preprice]"]').val() == ''||Number($('input[name="goods[preprice]"]').val())<0.01) {
                    util.message('请填写订金金额');
                    return false;
                }
                if ($('#param-items-level tr').length < 1) {
                    util.message('请添加阶梯数据');
                    return false;
                }
                if ($('#param-items-level input[name="param_groupnum[]"]').val() == '' || $('#param-items-level input[name="param_groupprice[]"]').val() == '') {
                    util.message('阶梯数据不能为空');
                    return false;
                }
                if (Number($('input[name="goods[oprice]"]').val())<Number($('input[name="goods[preprice]"]').val())) {
                    util.message('商品价格逻辑设置错误，订金金额不能大于单买价，请重新设置！');
                    return false;
                }
                for(var i=0;i<$('input[name="param_groupprice[]"]').length;i++){
                    if(Number($('input[name="param_groupprice[]"]')[i].value)<Number($('input[name="goods[preprice]"]').val())){
                        util.message('商品价格逻辑设置错误，订金金额不能大于团购价，请重新设置！');
                        return false;
                    }
                }
                if ($('input[name="endtime"]').val() == ''||$('input[name="endtime"]').val()<1) {
                    util.message('请填写组团限时');
                    return false;
                }
            }
        }
		if($(self).hasClass('GuiGe')){
			for(var i=0;i<$('.spec_title').length;i++){
				var str = $($('.spec_title')[i]).val();
				var patt1 = new RegExp(/[\u4e00-\u9fa5_a-zA-Z]/);
				var result = patt1.test(str);
				if(!result){
					util.message('规格名必须包含字母或汉字');
					return false;
				}
			}
			for(var i=0;i<$('.spec_item_title').length;i++){
				var str = $($('.spec_item_title')[i]).val();
				var patt1 = new RegExp(/[\u4e00-\u9fa5_a-zA-Z]/);
				var result = patt1.test(str);
				if(!result){
					util.message('规格项必须包含字母或汉字');
					return false;
				}
			}
		}
        if($(self).hasClass('PeiSong')){//配送方式
        	if (switchType == 0){
				if ("{php echo $_W['account']['vip']}" != '1' || $('input[name="spike"]:checked').val() != '1') {
					return false;
				}
			}
            for(var i=0;i<$('#tab_hexiao .radio>input').length;i++){
                if($('#tab_hexiao .radio>input')[i].checked){
                    var num=Number($($('#tab_hexiao .radio>input')[i]).attr('data-val'));
                    if(num==1||num==7){
                        if($('#dispatch input').length<1){
                            util.message('请选择运费模板');
                            return false;
                        }
                        if($('#stores input').length<1){
                            util.message('请选择自提门店');
                            return false;
                        }
                    }else if(num==2||num==4){
                        if($('#dispatch input').length<1){
                            util.message('请选择运费模板');
                            return false;
                        }
                    }else if(num==3||num==6){
                        if($('#stores input').length<1){
                            util.message('请选择自提门店');
                            return false;
                        }
                    }
                }
            }
        }
        if($(self).hasClass('GuiGe')) {//规格
            if($('#hasoption')[0].checked){
                if($('#options table').length>0) {
                    for (var i = 0; i < $('#options tbody input[type="text"]').length; i++) {
                        if ($('#options tbody input[type="text"]')[i].value == '') {
                            util.message('请填写规格数据');
                            return false;
                        }
                    }
                }else{
                    util.message('请填写规格数据');
                    return false;
                }
            }
        }
        if($('input[name="goods[commissiontype]"]').length>0) {
            if ($(self).hasClass('CuXiao')) {//促销方式
                for (var i = 0; i < 2; i++) {
                    if ($('input[name="goods[commissiontype]"]')[i].checked && $('input[name="goods[commission]"]').val() == "") {
                        util.message('请选填写佣金');
                        return false;
                    }
                }
            }
        }
        $('.tab-content>.tab-pane').removeClass('active');
        $(self).parent().parent().next().addClass('active');
    }

    function changeMS(){
        $('#Choose').fadeIn();
    }
    {if $goods['hasoption']==1&&$goods['supply_goodsid']>0}
    $('#specs,table h4,#options .info').hide();
    {/if}
    //編輯詳情簡介
    function editjj() {
        $('[name="isGo"]').val('1');
        $('[name="submit"]').click();
    }
</script>
<script src="{TG_URL_WRES}js/lib/jquery-ui-1.10.3.min.js"></script>
{php include wl_template('common/footer');}